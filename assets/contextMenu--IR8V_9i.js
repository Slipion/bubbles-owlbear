import{O as j}from"./getPluginId-CxRP2hJM.js";import{r as x,j as t,b as F,d as $}from"./colorHelpers-BcMsshZ9.js";import{B as A,a as D,i as N,g as U,w as S}from"./BookOpen-BXXlLJzx.js";import{a as B,p as I}from"./itemMetadataHelpers-C1JOvmed.js";import{h as z,i as P,j as L,g as k,B as G,T as W}from"./tooltip-Btg1nITJ.js";import{a as M,g as v,w as T,b as K}from"./getGlobalSettings-C1KsdlI9.js";import"./itemMetadataIds-Chv2A94E.js";import"./metadataHelpers-DJltngHl.js";import"./settingMetadataHelpers-B1IUCCwG.js";function b({parentValue:e,onUserConfirm:l,className:n,...s}){const[a,i]=x.useState(e),[d,m]=x.useState(!1);d&&(i(e),m(!1)),x.useEffect(()=>m(!0),[e]);const u=()=>i(e);let g=!1;const h=o=>{g=!0,o.target.blur(),g=!1},f=o=>{l(o.target),m(!0)};return t.jsx("input",{...s,value:a,onChange:o=>{s.onChange&&s.onChange(o),i(o.target.value)},onBlur:o=>{s.onBlur&&s.onBlur(o),g||(a===""?u():f(o))},onKeyDown:o=>{s.onKeyDown&&s.onKeyDown(o),o.key==="Enter"?(h(o),f(o)):o.key==="Escape"&&(h(o),u())},onFocus:o=>{s.onFocus&&s.onFocus(o),i("")},className:n,placeholder:"",autoComplete:"off"})}function w({open:e,text:l,color:n,children:s}){return t.jsxs(z,{open:e,children:[t.jsx(P,{asChild:!0,children:t.jsx("div",{children:s})}),t.jsx(L,{side:"top",sideOffset:-8,align:"center",alignOffset:0,className:k("min-w-6 px-1 py-0.5 text-center text-sm font-medium leading-5",{"dark:bg-stat-red-highlight-dark":n==="RED","dark:bg-stat-green-highlight-dark":n==="GREEN","dark:bg-stat-blue-highlight-dark":n==="BLUE"}),children:l})]})}function V({parentValue:e,parentMax:l,color:n,valueUpdateHandler:s,maxUpdateHandler:a,valueName:i,maxName:d,animateOnlyWhenRootActive:m=!1}){const[u,g]=x.useState(!1),[h,f]=x.useState(!1),o=m?"group-focus-within/root:duration-75 group-hover/root:duration-75":"duration-75";return t.jsx("div",{className:"grid grid-cols-1 grid-rows-1 place-items-center drop-shadow-sm focus-within:bg-transparent focus-within:drop-shadow-md",children:t.jsxs("div",{className:k(o,"peer col-span-full row-span-full flex h-[44px] w-[100px] justify-between rounded-xl pb-[2px] outline-0 dark:outline dark:outline-2 dark:-outline-offset-2 dark:outline-white/40",{"bg-stat-red/10 fill-stat-red/25 dark:bg-stat-red-dark/10 dark:fill-stat-red-dark/20 dark:focus-within:outline-stat-red-highlight-dark":n==="RED"}),children:[t.jsxs("div",{className:"pointer-events-none absolute -z-30",children:[u&&t.jsx(_,{}),h&&t.jsx(X,{}),!u&&!h&&t.jsx("div",{className:k("h-[44px] w-[100px] rounded-xl",{"bg-stat-red/25 dark:bg-stat-red-dark/20":n==="RED"})})]}),t.jsx(w,{open:u&&e!==0,text:e.toString(),color:n,children:t.jsx(b,{parentValue:e.toString(),name:i,onUserConfirm:s,onFocus:()=>g(!0),onBlur:()=>g(!1),className:k("size-[44px] rounded-xl bg-transparent text-center font-normal text-text-primary outline-none dark:text-text-primary-dark")})}),t.jsx("div",{className:k("flex h-full items-center justify-center pt-[2px] text-text-primary dark:text-text-primary-dark"),children:"/"}),t.jsx(w,{open:h&&l!==0,text:l.toString(),color:n,children:t.jsx(b,{parentValue:l.toString(),name:d,onUserConfirm:a,onFocus:()=>f(!0),onBlur:()=>f(!1),className:k("size-[44px] rounded-xl bg-transparent text-center font-normal text-text-primary outline-none dark:text-text-primary-dark")})})]})})}function _(){return t.jsx("svg",{children:t.jsx("path",{d:`
          M 44 22
          l 0 -10 
          a 12 12 -90 0 0 -12 -12
          l 56 0
          a 12 12 90 0 1 12 12
          l 0 20
          a 12 12 90 0 1 -12 12
          l -56 0
          a 12 12 -90 0 0 12 -12
          l 0 -10
        `})})}function X(){return t.jsx("svg",{children:t.jsx("path",{d:`
          M 56 22
          l 0 -10 
          a 12 12 -90 0 1 12 -12
          l -56 0
          a 12 12 90 0 0 -12 12
          l 0 20
          a 12 12 90 0 0 12 12
          l 56 0
          a 12 12 -90 0 1 -12 -12
          l 0 -10
        `})})}function C({parentValue:e,color:l,updateHandler:n,name:s,animateOnlyWhenRootActive:a=!1}){const[i,d]=x.useState(!1),m=a?"group-focus-within/root:duration-75 group-hover/root:duration-75":"duration-75",u=a?"group-focus-within/root:duration-100 group-hover/root:duration-100":"duration-100";return t.jsx("div",{className:`${m} grid grid-cols-1 grid-rows-1 place-items-center drop-shadow-sm focus-within:drop-shadow-md`,children:t.jsx("div",{className:k(u,{"bg-stat-green/40 focus-within:bg-stat-green/10 dark:bg-stat-green-dark/30 dark:focus-within:bg-stat-green-dark/10 dark:focus-within:outline-stat-green-highlight-dark":l==="GREEN","bg-stat-blue/40 focus-within:bg-stat-blue/10 dark:bg-stat-blue-dark/30 dark:focus-within:bg-stat-blue-dark/10 dark:focus-within:outline-stat-blue-highlight-dark":l==="BLUE"},"peer col-span-full row-span-full size-[44px] rounded-full bg-opacity-0 dark:outline dark:outline-2 dark:-outline-offset-2 dark:outline-white/40"),children:t.jsx(w,{open:i&&e!==0,text:e.toString(),color:l,children:t.jsx(b,{name:s,onFocus:()=>d(!0),onBlur:()=>d(!1),parentValue:e.toString(),onUserConfirm:n,className:`${u} size-[44px] rounded-full bg-transparent text-center font-normal text-text-primary outline-none dark:text-text-primary-dark`})})})})}function Y({updateHandler:e,inputProps:l,animateOnlyWhenRootActive:n=!1}){const s=n?"group-focus-within/root:duration-100 group-hover/root:duration-100":"duration-100",a=i=>{e(i)};return t.jsx("input",{...l,spellCheck:!1,onBlur:i=>a(i.target),onKeyDown:i=>{i.key==="Enter"&&a(i.target)},className:`${s} h-[36px] w-full rounded-xl bg-mirage-950/5 px-1.5 py-1 text-center text-base text-text-primary outline-none -outline-offset-2 outline-mirage-950/10 hover:outline-black/25 focus:outline-primary dark:bg-mirage-950/40 dark:text-text-primary-dark dark:outline dark:outline-2 dark:outline-white/20 dark:hover:outline-white/60 dark:focus:outline-primary-dark`})}function q({Icon:e,onClick:l,rounded:n="rounded-full",padding:s="p-[2px]",danger:a=!1,animateOnlyWhenRootActive:i=!1}){const d=i?"group-focus-within/root:duration-100 group-hover/root:duration-100":"duration-100";return t.jsx("button",{className:`group flex items-center justify-center ${n} ${s} outline-none`,onClick:l,children:t.jsx("div",{className:`flex h-[36px] w-[36px] items-center justify-center ${d} ${n} ${a?"group-hover:bg-red-400/60 group-focus-visible:bg-red-400/60 group-hover:dark:bg-red-400/30 group-focus-visible:dark:bg-red-400/30":"group-hover:bg-black/10 group-focus-visible:bg-black/10 group-hover:dark:bg-white/10 group-focus-visible:dark:bg-white/10"}`,children:t.jsx(e,{className:"h-[24px] w-[24px] fill-text-secondary dark:fill-text-secondary-dark"})})})}function J(e){return t.jsxs("svg",{...e,xmlns:"http://www.w3.org/2000/svg",height:"800px",width:"800px",viewBox:"0 0 36 36",children:[t.jsx("path",{fill:"#FFAC33",d:"M34.347 16.893l-8.899-3.294l-3.323-10.891a1 1 0 0 0-1.912 0l-3.322 10.891l-8.9 3.294a1 1 0 0 0 0 1.876l8.895 3.293l3.324 11.223a1 1 0 0 0 1.918-.001l3.324-11.223l8.896-3.293a.998.998 0 0 0-.001-1.875z"}),t.jsx("path",{fill:"#FFCC4D",d:"M14.347 27.894l-2.314-.856l-.9-3.3a.998.998 0 0 0-1.929-.001l-.9 3.3l-2.313.856a1 1 0 0 0 0 1.876l2.301.853l.907 3.622a1 1 0 0 0 1.94-.001l.907-3.622l2.301-.853a.997.997 0 0 0 0-1.874zM10.009 6.231l-2.364-.875l-.876-2.365a.999.999 0 0 0-1.876 0l-.875 2.365l-2.365.875a1 1 0 0 0 0 1.876l2.365.875l.875 2.365a1 1 0 0 0 1.876 0l.875-2.365l2.365-.875a1 1 0 0 0 0-1.876z"})]})}function Q({initialToken:e,initialTokenName:l,initialNameTagsEnabled:n,role:s}){const[a,i]=x.useState(e);x.useEffect(()=>j.scene.items.onChange(()=>{const r=c=>{let p=c[0];i(p)};B().then(c=>{r(I(c)),g(M(c[0]))})}),[]);function d(r,c){const p=r.name;if(!N(p))throw"Error: invalid input name.";const y=U(p,r.value,c);i(O=>({...O,[p]:y})),S(a.item.id,p,y)}function m(){const r="hideStats";if(!N(r))throw"Error: invalid input name.";const c=!a.hideStats;i(p=>({...p,[r]:c})),S(a.item.id,r,c)}const[u,g]=x.useState(l),[h,f]=x.useState(n);x.useEffect(()=>j.scene.onMetadataChange(async r=>{const c=(await v(void 0,r,void 0)).settings.nameTags;f(c)})),x.useEffect(()=>j.room.onMetadataChange(async r=>{const c=(await v(void 0,void 0,r)).settings.nameTags;f(c)}));const o=t.jsxs("div",{className:"grid grid-cols-[1fr,auto,1fr] place-items-center",children:[t.jsx("div",{}),t.jsx("div",{className:"w-[144px]",children:t.jsx(Y,{updateHandler:r=>{const c=r.value.replaceAll(" ","")!=="";T(r.value,c)},inputProps:{placeholder:"Name",value:u,onChange:r=>{g(r.target.value)}},animateOnlyWhenRootActive:!0})}),u===""&&t.jsx("div",{className:"right-0 top-0",children:t.jsx(q,{Icon:J,onClick:()=>{K().then(r=>{g(r),T(r)})},padding:"",animateOnlyWhenRootActive:!0})})]}),R=t.jsxs("div",{className:"grid grid-cols-4 rounded-lg bg-mirage-950/[0.07] fill-text-secondary p-1 py-1 dark:bg-mirage-50/[0.07] dark:fill-text-secondary-dark",children:[t.jsxs("div",{className:"col-span-2 grid grid-cols-1 grid-rows-[12px_1fr_12px] justify-items-center gap-y-[1px]",children:[t.jsx("h2",{className:"col-span-2 flex justify-center self-start text-2xs font-medium tracking-wider text-text-secondary dark:text-text-secondary-dark",children:"HIT POINTS"}),t.jsx(V,{parentValue:a.health,parentMax:a.maxHealth,color:"RED",valueUpdateHandler:async r=>d(r,a.health),maxUpdateHandler:async r=>d(r,a.maxHealth),valueName:"health",maxName:"maxHealth",animateOnlyWhenRootActive:!0}),t.jsx("h2",{className:"col-span-2 flex justify-center self-start text-2xs font-medium tracking-wider text-text-secondary dark:text-text-secondary-dark",children:"& MAXIMUM"})]}),t.jsx("div",{className:"col-start-3 row-start-1 flex items-center justify-center",children:t.jsx("div",{className:"size-0",children:t.jsx(E,{topText:"TEMPORARY",bottomText:"HIT POINTS",letterSpacing:.8})})}),t.jsx("div",{className:"col-start-3 row-start-1 flex size-full items-center justify-center",children:t.jsx(C,{parentValue:a.tempHealth,color:"GREEN",updateHandler:r=>d(r,a.tempHealth),name:"tempHealth",animateOnlyWhenRootActive:!0})}),t.jsx("div",{className:"col-start-4 row-start-1 flex items-center justify-center",children:t.jsx("div",{className:"size-0",children:t.jsx(E,{topText:"ARMOR",bottomText:"CLASS",letterSpacing:1})})}),t.jsx("div",{className:"col-start-4 row-start-1 flex size-full items-center justify-center",children:t.jsx(C,{parentValue:a.armorClass,color:"BLUE",updateHandler:r=>d(r,a.armorClass),name:"armorClass",animateOnlyWhenRootActive:!0})})]}),H=t.jsx("div",{children:t.jsx(G,{variant:"ghost",className:k("size-full rounded-lg bg-mirage-950/[0.07] text-base font-normal text-text-primary hover:bg-mirage-950/15 dark:bg-mirage-50/[0.07] dark:text-text-primary-dark dark:hover:bg-mirage-50/15"),onClick:()=>m(),children:a.hideStats?t.jsxs("div",{className:"inline-flex items-center gap-2 text-primary-800 hover:text-primary-800 dark:text-primary-dark-300 dark:hover:text-primary-dark-300",children:[t.jsx(A,{}),t.jsx("div",{children:"Dungeon Master Only"})]}):t.jsxs("div",{className:"inline-flex items-center gap-2",children:[t.jsx(D,{}),t.jsx("div",{children:"Player Editable"})]})})});return t.jsxs("div",{className:"h-full space-y-2 overflow-hidden px-2 py-1",children:[h&&o,R,s==="GM"&&H]})}const E=({topText:e,bottomText:l,letterSpacing:n})=>t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"overflow-visible text-2xs font-medium",children:[t.jsx("path",{id:"topCirclePath",d:`
          M -29 0
          A 29 29 0 0,1 29,0
        `,fillOpacity:0}),t.jsx("path",{id:"bottomCirclePath",d:`
            M -29 0
            A 29 29 0 0,0 29,0
          `,fillOpacity:0}),t.jsx("text",{children:t.jsx("textPath",{href:"#topCirclePath",startOffset:"50%",dominantBaseline:"central",textAnchor:"middle",letterSpacing:n,children:e})}),t.jsx("text",{children:t.jsx("textPath",{href:"#bottomCirclePath",startOffset:"50%",dominantBaseline:"central",textAnchor:"middle",letterSpacing:n,children:l})})]});j.onReady(async()=>{const[e,l,n,s]=await Promise.all([B(),j.player.getRole(),j.scene.getMetadata(),j.room.getMetadata()]),a=I(e),i=M(e[0]);F();const d=(await v(void 0,n,s)).settings.nameTags;if(e.length!==1)throw"Error: Invalid Tokens Selection";$(document.getElementById("app")).render(t.jsx(W,{children:t.jsx(Q,{initialToken:a[0],initialTokenName:i,initialNameTagsEnabled:typeof d=="boolean"?d:!1,role:l})}))});
