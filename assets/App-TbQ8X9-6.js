var qs=Object.defineProperty;var Zs=(e,t,n)=>t in e?qs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var cr=(e,t,n)=>Zs(e,typeof t!="symbol"?t+"":t,n);import{r as a,e as Qs,j as i,f as ze,R as se,b as Js}from"./colorHelpers-BcMsshZ9.js";import{k as Ie,P as V,e as Cn,b as te,l as Hr,d as $t,R as Fr,u as Xt,c as H,A as On,m as qt,f as An,a as Ln,D as zr,C as $r,n as Vr,g as L,h as vt,i as xt,j as bt,B as Ce,o as ea,V as ta,p as na,T as ra}from"./tooltip-Btg1nITJ.js";import{I as oa,S as _n,u as sa,c as aa,a as ur,L as Tt,P as ia,H as la,Q as ca,B as ua,b as da}from"./index-CH8uBEVA.js";import{c as Wr,o as fa,a as dr,C as ha,P as pa,g as Bn,b as ma,d as ga,f as va,h as xa,D as ba,r as wa,u as ya,e as fr,w as Ca}from"./action-D0fEXBzU.js";import{O as ee,g as Sa}from"./getPluginId-CxRP2hJM.js";import{B as Ra,a as Ea,i as Ur,g as Na,w as Kr}from"./BookOpen-BXXlLJzx.js";import{p as ja,b as hr}from"./itemMetadataHelpers-C1JOvmed.js";import"./itemMetadataIds-Chv2A94E.js";import"./menuIcon-BywqSbDq.js";import"./metadataHelpers-DJltngHl.js";var Ia="Portal",Hn=a.forwardRef((e,t)=>{var l;const{container:n,...r}=e,[o,s]=a.useState(!1);Ie(()=>s(!0),[]);const c=n||o&&((l=globalThis==null?void 0:globalThis.document)==null?void 0:l.body);return c?Qs.createPortal(i.jsx(V.div,{...r,ref:t}),c):null});Hn.displayName=Ia;var un=0;function Gr(){a.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??pr()),document.body.insertAdjacentElement("beforeend",e[1]??pr()),un++,()=>{un===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),un--}},[])}function pr(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var dn="focusScope.autoFocusOnMount",fn="focusScope.autoFocusOnUnmount",mr={bubbles:!1,cancelable:!0},Ta="FocusScope",Fn=a.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...c}=e,[l,u]=a.useState(null),d=Cn(o),h=Cn(s),m=a.useRef(null),w=te(t,f=>u(f)),p=a.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;a.useEffect(()=>{if(r){let f=function(x){if(p.paused||!l)return;const y=x.target;l.contains(y)?m.current=y:Oe(m.current,{select:!0})},b=function(x){if(p.paused||!l)return;const y=x.relatedTarget;y!==null&&(l.contains(y)||Oe(m.current,{select:!0}))},v=function(x){if(document.activeElement===document.body)for(const C of x)C.removedNodes.length>0&&Oe(l)};document.addEventListener("focusin",f),document.addEventListener("focusout",b);const g=new MutationObserver(v);return l&&g.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",f),document.removeEventListener("focusout",b),g.disconnect()}}},[r,l,p.paused]),a.useEffect(()=>{if(l){vr.add(p);const f=document.activeElement;if(!l.contains(f)){const v=new CustomEvent(dn,mr);l.addEventListener(dn,d),l.dispatchEvent(v),v.defaultPrevented||(Pa(Aa(Yr(l)),{select:!0}),document.activeElement===f&&Oe(l))}return()=>{l.removeEventListener(dn,d),setTimeout(()=>{const v=new CustomEvent(fn,mr);l.addEventListener(fn,h),l.dispatchEvent(v),v.defaultPrevented||Oe(f??document.body,{select:!0}),l.removeEventListener(fn,h),vr.remove(p)},0)}}},[l,d,h,p]);const S=a.useCallback(f=>{if(!n&&!r||p.paused)return;const b=f.key==="Tab"&&!f.altKey&&!f.ctrlKey&&!f.metaKey,v=document.activeElement;if(b&&v){const g=f.currentTarget,[x,y]=Da(g);x&&y?!f.shiftKey&&v===y?(f.preventDefault(),n&&Oe(x,{select:!0})):f.shiftKey&&v===x&&(f.preventDefault(),n&&Oe(y,{select:!0})):v===g&&f.preventDefault()}},[n,r,p.paused]);return i.jsx(V.div,{tabIndex:-1,...c,ref:w,onKeyDown:S})});Fn.displayName=Ta;function Pa(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(Oe(r,{select:t}),document.activeElement!==n)return}function Da(e){const t=Yr(e),n=gr(t,e),r=gr(t.reverse(),e);return[n,r]}function Yr(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function gr(e,t){for(const n of e)if(!ka(n,{upTo:t}))return n}function ka(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function Ma(e){return e instanceof HTMLInputElement&&"select"in e}function Oe(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&Ma(e)&&t&&e.select()}}var vr=Oa();function Oa(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=xr(e,t),e.unshift(t)},remove(t){var n;e=xr(e,t),(n=e[0])==null||n.resume()}}}function xr(e,t){const n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function Aa(e){return e.filter(t=>t.tagName!=="A")}function La(e){const t=_a(e),n=a.forwardRef((r,o)=>{const{children:s,...c}=r,l=a.Children.toArray(s),u=l.find(Ha);if(u){const d=u.props.children,h=l.map(m=>m===u?a.Children.count(d)>1?a.Children.only(null):a.isValidElement(d)?d.props.children:null:m);return i.jsx(t,{...c,ref:o,children:a.isValidElement(d)?a.cloneElement(d,void 0,h):null})}return i.jsx(t,{...c,ref:o,children:s})});return n.displayName=`${e}.Slot`,n}function _a(e){const t=a.forwardRef((n,r)=>{const{children:o,...s}=n;if(a.isValidElement(o)){const c=za(o),l=Fa(s,o.props);return o.type!==a.Fragment&&(l.ref=r?Hr(r,c):c),a.cloneElement(o,l)}return a.Children.count(o)>1?a.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Ba=Symbol("radix.slottable");function Ha(e){return a.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Ba}function Fa(e,t){const n={...t};for(const r in t){const o=e[r],s=t[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...l)=>{const u=s(...l);return o(...l),u}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...e,...n}}function za(e){var r,o;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var $a=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},qe=new WeakMap,Pt=new WeakMap,Dt={},hn=0,Xr=function(e){return e&&(e.host||Xr(e.parentNode))},Va=function(e,t){return t.map(function(n){if(e.contains(n))return n;var r=Xr(n);return r&&e.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},Wa=function(e,t,n,r){var o=Va(t,Array.isArray(e)?e:[e]);Dt[n]||(Dt[n]=new WeakMap);var s=Dt[n],c=[],l=new Set,u=new Set(o),d=function(m){!m||l.has(m)||(l.add(m),d(m.parentNode))};o.forEach(d);var h=function(m){!m||u.has(m)||Array.prototype.forEach.call(m.children,function(w){if(l.has(w))h(w);else try{var p=w.getAttribute(r),S=p!==null&&p!=="false",f=(qe.get(w)||0)+1,b=(s.get(w)||0)+1;qe.set(w,f),s.set(w,b),c.push(w),f===1&&S&&Pt.set(w,!0),b===1&&w.setAttribute(n,"true"),S||w.setAttribute(r,"true")}catch(v){console.error("aria-hidden: cannot operate on ",w,v)}})};return h(t),l.clear(),hn++,function(){c.forEach(function(m){var w=qe.get(m)-1,p=s.get(m)-1;qe.set(m,w),s.set(m,p),w||(Pt.has(m)||m.removeAttribute(r),Pt.delete(m)),p||m.removeAttribute(n)}),hn--,hn||(qe=new WeakMap,qe=new WeakMap,Pt=new WeakMap,Dt={})}},qr=function(e,t,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),o=$a(e);return o?(r.push.apply(r,Array.from(o.querySelectorAll("[aria-live], script"))),Wa(r,o,n,"aria-hidden")):function(){return null}},ye=function(){return ye=Object.assign||function(t){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},ye.apply(this,arguments)};function Zr(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]]);return n}function Ua(e,t,n){if(n||arguments.length===2)for(var r=0,o=t.length,s;r<o;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))}var Ht="right-scroll-bar-position",Ft="width-before-scroll-bar",Ka="with-scroll-bars-hidden",Ga="--removed-body-scroll-bar-size";function pn(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function Ya(e,t){var n=a.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(r){var o=n.value;o!==r&&(n.value=r,n.callback(r,o))}}}})[0];return n.callback=t,n.facade}var Xa=typeof window<"u"?a.useLayoutEffect:a.useEffect,br=new WeakMap;function qa(e,t){var n=Ya(null,function(r){return e.forEach(function(o){return pn(o,r)})});return Xa(function(){var r=br.get(n);if(r){var o=new Set(r),s=new Set(e),c=n.current;o.forEach(function(l){s.has(l)||pn(l,null)}),s.forEach(function(l){o.has(l)||pn(l,c)})}br.set(n,e)},[e]),n}function Za(e){return e}function Qa(e,t){t===void 0&&(t=Za);var n=[],r=!1,o={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(s){var c=t(s,r);return n.push(c),function(){n=n.filter(function(l){return l!==c})}},assignSyncMedium:function(s){for(r=!0;n.length;){var c=n;n=[],c.forEach(s)}n={push:function(l){return s(l)},filter:function(){return n}}},assignMedium:function(s){r=!0;var c=[];if(n.length){var l=n;n=[],l.forEach(s),c=n}var u=function(){var h=c;c=[],h.forEach(s)},d=function(){return Promise.resolve().then(u)};d(),n={push:function(h){c.push(h),d()},filter:function(h){return c=c.filter(h),n}}}};return o}function Ja(e){e===void 0&&(e={});var t=Qa(null);return t.options=ye({async:!0,ssr:!1},e),t}var Qr=function(e){var t=e.sideCar,n=Zr(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw new Error("Sidecar medium not found");return a.createElement(r,ye({},n))};Qr.isSideCarExport=!0;function ei(e,t){return e.useMedium(t),Qr}var Jr=Ja(),mn=function(){},Zt=a.forwardRef(function(e,t){var n=a.useRef(null),r=a.useState({onScrollCapture:mn,onWheelCapture:mn,onTouchMoveCapture:mn}),o=r[0],s=r[1],c=e.forwardProps,l=e.children,u=e.className,d=e.removeScrollBar,h=e.enabled,m=e.shards,w=e.sideCar,p=e.noRelative,S=e.noIsolation,f=e.inert,b=e.allowPinchZoom,v=e.as,g=v===void 0?"div":v,x=e.gapMode,y=Zr(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),C=w,E=qa([n,t]),R=ye(ye({},y),o);return a.createElement(a.Fragment,null,h&&a.createElement(C,{sideCar:Jr,removeScrollBar:d,shards:m,noRelative:p,noIsolation:S,inert:f,setCallbacks:s,allowPinchZoom:!!b,lockRef:n,gapMode:x}),c?a.cloneElement(a.Children.only(l),ye(ye({},R),{ref:E})):a.createElement(g,ye({},R,{className:u,ref:E}),l))});Zt.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Zt.classNames={fullWidth:Ft,zeroRight:Ht};var ti=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function ni(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=ti();return t&&e.setAttribute("nonce",t),e}function ri(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function oi(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var si=function(){var e=0,t=null;return{add:function(n){e==0&&(t=ni())&&(ri(t,n),oi(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},ai=function(){var e=si();return function(t,n){a.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},eo=function(){var e=ai(),t=function(n){var r=n.styles,o=n.dynamic;return e(r,o),null};return t},ii={left:0,top:0,right:0,gap:0},gn=function(e){return parseInt(e||"",10)||0},li=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],r=t[e==="padding"?"paddingTop":"marginTop"],o=t[e==="padding"?"paddingRight":"marginRight"];return[gn(n),gn(r),gn(o)]},ci=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return ii;var t=li(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},ui=eo(),et="data-scroll-locked",di=function(e,t,n,r){var o=e.left,s=e.top,c=e.right,l=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(Ka,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(l,"px ").concat(r,`;
  }
  body[`).concat(et,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(c,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(l,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Ht,` {
    right: `).concat(l,"px ").concat(r,`;
  }
  
  .`).concat(Ft,` {
    margin-right: `).concat(l,"px ").concat(r,`;
  }
  
  .`).concat(Ht," .").concat(Ht,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(Ft," .").concat(Ft,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(et,`] {
    `).concat(Ga,": ").concat(l,`px;
  }
`)},wr=function(){var e=parseInt(document.body.getAttribute(et)||"0",10);return isFinite(e)?e:0},fi=function(){a.useEffect(function(){return document.body.setAttribute(et,(wr()+1).toString()),function(){var e=wr()-1;e<=0?document.body.removeAttribute(et):document.body.setAttribute(et,e.toString())}},[])},hi=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,o=r===void 0?"margin":r;fi();var s=a.useMemo(function(){return ci(o)},[o]);return a.createElement(ui,{styles:di(s,!t,o,n?"":"!important")})},Sn=!1;if(typeof window<"u")try{var kt=Object.defineProperty({},"passive",{get:function(){return Sn=!0,!0}});window.addEventListener("test",kt,kt),window.removeEventListener("test",kt,kt)}catch{Sn=!1}var Ze=Sn?{passive:!1}:!1,pi=function(e){return e.tagName==="TEXTAREA"},to=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!pi(e)&&n[t]==="visible")},mi=function(e){return to(e,"overflowY")},gi=function(e){return to(e,"overflowX")},yr=function(e,t){var n=t.ownerDocument,r=t;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=no(e,r);if(o){var s=ro(e,r),c=s[1],l=s[2];if(c>l)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},vi=function(e){var t=e.scrollTop,n=e.scrollHeight,r=e.clientHeight;return[t,n,r]},xi=function(e){var t=e.scrollLeft,n=e.scrollWidth,r=e.clientWidth;return[t,n,r]},no=function(e,t){return e==="v"?mi(t):gi(t)},ro=function(e,t){return e==="v"?vi(t):xi(t)},bi=function(e,t){return e==="h"&&t==="rtl"?-1:1},wi=function(e,t,n,r,o){var s=bi(e,window.getComputedStyle(t).direction),c=s*r,l=n.target,u=t.contains(l),d=!1,h=c>0,m=0,w=0;do{if(!l)break;var p=ro(e,l),S=p[0],f=p[1],b=p[2],v=f-b-s*S;(S||v)&&no(e,l)&&(m+=v,w+=S);var g=l.parentNode;l=g&&g.nodeType===Node.DOCUMENT_FRAGMENT_NODE?g.host:g}while(!u&&l!==document.body||u&&(t.contains(l)||t===l));return(h&&Math.abs(m)<1||!h&&Math.abs(w)<1)&&(d=!0),d},Mt=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},Cr=function(e){return[e.deltaX,e.deltaY]},Sr=function(e){return e&&"current"in e?e.current:e},yi=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Ci=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},Si=0,Qe=[];function Ri(e){var t=a.useRef([]),n=a.useRef([0,0]),r=a.useRef(),o=a.useState(Si++)[0],s=a.useState(eo)[0],c=a.useRef(e);a.useEffect(function(){c.current=e},[e]),a.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(o));var f=Ua([e.lockRef.current],(e.shards||[]).map(Sr),!0).filter(Boolean);return f.forEach(function(b){return b.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),f.forEach(function(b){return b.classList.remove("allow-interactivity-".concat(o))})}}},[e.inert,e.lockRef.current,e.shards]);var l=a.useCallback(function(f,b){if("touches"in f&&f.touches.length===2||f.type==="wheel"&&f.ctrlKey)return!c.current.allowPinchZoom;var v=Mt(f),g=n.current,x="deltaX"in f?f.deltaX:g[0]-v[0],y="deltaY"in f?f.deltaY:g[1]-v[1],C,E=f.target,R=Math.abs(x)>Math.abs(y)?"h":"v";if("touches"in f&&R==="h"&&E.type==="range")return!1;var j=window.getSelection(),D=j&&j.anchorNode,P=D?D===E||D.contains(E):!1;if(P)return!1;var T=yr(R,E);if(!T)return!0;if(T?C=R:(C=R==="v"?"h":"v",T=yr(R,E)),!T)return!1;if(!r.current&&"changedTouches"in f&&(x||y)&&(r.current=C),!C)return!0;var _=r.current||C;return wi(_,b,f,_==="h"?x:y)},[]),u=a.useCallback(function(f){var b=f;if(!(!Qe.length||Qe[Qe.length-1]!==s)){var v="deltaY"in b?Cr(b):Mt(b),g=t.current.filter(function(C){return C.name===b.type&&(C.target===b.target||b.target===C.shadowParent)&&yi(C.delta,v)})[0];if(g&&g.should){b.cancelable&&b.preventDefault();return}if(!g){var x=(c.current.shards||[]).map(Sr).filter(Boolean).filter(function(C){return C.contains(b.target)}),y=x.length>0?l(b,x[0]):!c.current.noIsolation;y&&b.cancelable&&b.preventDefault()}}},[]),d=a.useCallback(function(f,b,v,g){var x={name:f,delta:b,target:v,should:g,shadowParent:Ei(v)};t.current.push(x),setTimeout(function(){t.current=t.current.filter(function(y){return y!==x})},1)},[]),h=a.useCallback(function(f){n.current=Mt(f),r.current=void 0},[]),m=a.useCallback(function(f){d(f.type,Cr(f),f.target,l(f,e.lockRef.current))},[]),w=a.useCallback(function(f){d(f.type,Mt(f),f.target,l(f,e.lockRef.current))},[]);a.useEffect(function(){return Qe.push(s),e.setCallbacks({onScrollCapture:m,onWheelCapture:m,onTouchMoveCapture:w}),document.addEventListener("wheel",u,Ze),document.addEventListener("touchmove",u,Ze),document.addEventListener("touchstart",h,Ze),function(){Qe=Qe.filter(function(f){return f!==s}),document.removeEventListener("wheel",u,Ze),document.removeEventListener("touchmove",u,Ze),document.removeEventListener("touchstart",h,Ze)}},[]);var p=e.removeScrollBar,S=e.inert;return a.createElement(a.Fragment,null,S?a.createElement(s,{styles:Ci(o)}):null,p?a.createElement(hi,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function Ei(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const Ni=ei(Jr,Ri);var zn=a.forwardRef(function(e,t){return a.createElement(Zt,ye({},e,{ref:t,sideCar:Ni}))});zn.classNames=Zt.classNames;var Qt="Popover",[oo]=Ln(Qt,[qt]),St=qt(),[ji,_e]=oo(Qt),so=e=>{const{__scopePopover:t,children:n,open:r,defaultOpen:o,onOpenChange:s,modal:c=!1}=e,l=St(t),u=a.useRef(null),[d,h]=a.useState(!1),[m,w]=$t({prop:r,defaultProp:o??!1,onChange:s,caller:Qt});return i.jsx(Fr,{...l,children:i.jsx(ji,{scope:t,contentId:Xt(),triggerRef:u,open:m,onOpenChange:w,onOpenToggle:a.useCallback(()=>w(p=>!p),[w]),hasCustomAnchor:d,onCustomAnchorAdd:a.useCallback(()=>h(!0),[]),onCustomAnchorRemove:a.useCallback(()=>h(!1),[]),modal:c,children:n})})};so.displayName=Qt;var ao="PopoverAnchor",Ii=a.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,o=_e(ao,n),s=St(n),{onCustomAnchorAdd:c,onCustomAnchorRemove:l}=o;return a.useEffect(()=>(c(),()=>l()),[c,l]),i.jsx(On,{...s,...r,ref:t})});Ii.displayName=ao;var io="PopoverTrigger",lo=a.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,o=_e(io,n),s=St(n),c=te(t,o.triggerRef),l=i.jsx(V.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":po(o.open),...r,ref:c,onClick:H(e.onClick,o.onOpenToggle)});return o.hasCustomAnchor?l:i.jsx(On,{asChild:!0,...s,children:l})});lo.displayName=io;var $n="PopoverPortal",[Ti,Pi]=oo($n,{forceMount:void 0}),co=e=>{const{__scopePopover:t,forceMount:n,children:r,container:o}=e,s=_e($n,t);return i.jsx(Ti,{scope:t,forceMount:n,children:i.jsx(An,{present:n||s.open,children:i.jsx(Hn,{asChild:!0,container:o,children:r})})})};co.displayName=$n;var nt="PopoverContent",uo=a.forwardRef((e,t)=>{const n=Pi(nt,e.__scopePopover),{forceMount:r=n.forceMount,...o}=e,s=_e(nt,e.__scopePopover);return i.jsx(An,{present:r||s.open,children:s.modal?i.jsx(ki,{...o,ref:t}):i.jsx(Mi,{...o,ref:t})})});uo.displayName=nt;var Di=La("PopoverContent.RemoveScroll"),ki=a.forwardRef((e,t)=>{const n=_e(nt,e.__scopePopover),r=a.useRef(null),o=te(t,r),s=a.useRef(!1);return a.useEffect(()=>{const c=r.current;if(c)return qr(c)},[]),i.jsx(zn,{as:Di,allowPinchZoom:!0,children:i.jsx(fo,{...e,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:H(e.onCloseAutoFocus,c=>{var l;c.preventDefault(),s.current||(l=n.triggerRef.current)==null||l.focus()}),onPointerDownOutside:H(e.onPointerDownOutside,c=>{const l=c.detail.originalEvent,u=l.button===0&&l.ctrlKey===!0,d=l.button===2||u;s.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:H(e.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1})})})}),Mi=a.forwardRef((e,t)=>{const n=_e(nt,e.__scopePopover),r=a.useRef(!1),o=a.useRef(!1);return i.jsx(fo,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var c,l;(c=e.onCloseAutoFocus)==null||c.call(e,s),s.defaultPrevented||(r.current||(l=n.triggerRef.current)==null||l.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{var u,d;(u=e.onInteractOutside)==null||u.call(e,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const c=s.target;((d=n.triggerRef.current)==null?void 0:d.contains(c))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),fo=a.forwardRef((e,t)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:c,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,...m}=e,w=_e(nt,n),p=St(n);return Gr(),i.jsx(Fn,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:i.jsx(zr,{asChild:!0,disableOutsidePointerEvents:c,onInteractOutside:h,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onDismiss:()=>w.onOpenChange(!1),children:i.jsx($r,{"data-state":po(w.open),role:"dialog",id:w.contentId,...p,...m,ref:t,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),ho="PopoverClose",Oi=a.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,o=_e(ho,n);return i.jsx(V.button,{type:"button",...r,ref:t,onClick:H(e.onClick,()=>o.onOpenChange(!1))})});Oi.displayName=ho;var Ai="PopoverArrow",Li=a.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,o=St(n);return i.jsx(Vr,{...o,...r,ref:t})});Li.displayName=Ai;function po(e){return e?"open":"closed"}var _i=so,Bi=lo,Hi=co,mo=uo;const Fi=_i,zi=Bi,go=a.forwardRef(({className:e,align:t="center",sideOffset:n=4,...r},o)=>i.jsx(Hi,{children:i.jsx(mo,{ref:o,align:t,sideOffset:n,className:L("z-50 w-72 rounded-md border-[1px] border-primary bg-mirage-50 p-4 text-mirage-950 shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-primary-dark dark:bg-mirage-950 dark:text-mirage-50",e),...r})}));go.displayName=mo.displayName;function $i(){return i.jsxs("svg",{height:"35px",width:"35px",version:"1.1",id:"_x32_",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512",xmlSpace:"preserve",className:"fill-black dark:fill-white",children:[i.jsx("g",{id:"SVGRepo_bgCarrier",strokeWidth:"0"}),i.jsx("g",{id:"SVGRepo_tracerCarrier",strokeLinecap:"round",strokeLinejoin:"round"}),i.jsxs("g",{id:"SVGRepo_iconCarrier",children:[" ",i.jsx("style",{type:"text/css",children:" "})," ",i.jsxs("g",{children:[" ",i.jsx("path",{className:"st0",d:"M449.532,105.602L288.463,8.989C278.474,2.994,267.235,0,256.011,0c-11.239,0-22.483,2.994-32.467,8.989 L62.475,105.602c-19.012,11.406-30.647,31.95-30.647,54.117v192.562c0,22.168,11.635,42.711,30.647,54.117l161.069,96.613 c9.984,5.988,21.228,8.989,32.467,8.989c11.225,0,22.463-3.001,32.452-8.989l161.069-96.613 c19.012-11.406,30.64-31.949,30.64-54.117V159.719C480.172,137.552,468.544,117.008,449.532,105.602z M250.599,492.733 c-6.029-0.745-11.93-2.719-17.32-5.948L72.21,390.172c-13.306-7.989-21.456-22.369-21.456-37.891V159.719 c0-6.022,1.236-11.862,3.518-17.233l196.328,117.76V492.733z M59.669,133.114c3.364-4.464,7.593-8.318,12.541-11.285 l161.069-96.613c6.995-4.196,14.85-6.291,22.732-6.291c7.868,0,15.723,2.095,22.718,6.291l161.069,96.613 c4.941,2.967,9.184,6.821,12.54,11.285L256.011,250.881L59.669,133.114z M461.254,352.281c0,15.522-8.15,29.902-21.456,37.891 l-161.069,96.613c-5.398,3.229-11.292,5.203-17.321,5.948V260.246l196.328-117.76c2.283,5.37,3.518,11.211,3.518,17.233V352.281z"})," ",i.jsx("path",{className:"st0",d:"M160.209,119.875c-9.828-7.278-26.021-7.465-36.165-0.41c-10.144,7.056-10.399,18.67-0.57,25.947 c9.828,7.277,26.022,7.459,36.159,0.41C169.783,138.766,170.038,127.152,160.209,119.875z"})," ",i.jsx("path",{className:"st0",d:"M279.159,48.686c-9.829-7.277-26.022-7.458-36.172-0.403c-10.137,7.049-10.393,18.664-0.564,25.941 c9.829,7.284,26.022,7.458,36.159,0.416C288.732,67.578,288.987,55.963,279.159,48.686z"})," ",i.jsx("path",{className:"st0",d:"M220.59,82.024c-9.834-7.27-26.028-7.458-36.172-0.403c-10.15,7.049-10.406,18.664-0.571,25.941 c9.829,7.284,26.022,7.458,36.166,0.416C230.151,100.916,230.412,89.302,220.59,82.024z"})," ",i.jsx("path",{className:"st0",d:"M267.437,184.754c-9.828-7.277-26.015-7.459-36.159-0.41c-10.15,7.056-10.405,18.671-0.577,25.947 c9.828,7.284,26.021,7.459,36.172,0.41C277.01,203.645,277.265,192.031,267.437,184.754z"})," ",i.jsx("path",{className:"st0",d:"M386.385,113.564c-9.828-7.271-26.021-7.458-36.158-0.403c-10.151,7.049-10.406,18.664-0.577,25.941 c9.828,7.284,26.02,7.458,36.172,0.416C395.959,132.456,396.214,120.842,386.385,113.564z"})," ",i.jsx("path",{className:"st0",d:"M327.817,146.903c-9.829-7.27-26.022-7.458-36.172-0.403c-10.137,7.049-10.392,18.664-0.564,25.941 c9.828,7.284,26.021,7.465,36.158,0.416C337.391,165.795,337.646,154.188,327.817,146.903z"})," ",i.jsx("path",{className:"st0",d:"M89.289,248.303c11.158,6.083,20.194,1.961,20.194-9.19c0-11.158-9.036-25.128-20.194-31.21 c-11.157-6.083-20.207-1.967-20.207,9.19C69.081,228.244,78.131,242.221,89.289,248.303z"})," ",i.jsx("path",{className:"st0",d:"M202.061,309.771c11.158,6.082,20.208,1.967,20.208-9.184c0-11.157-9.05-25.135-20.208-31.217 c-11.15-6.076-20.194-1.961-20.194,9.198C181.867,289.719,190.911,303.689,202.061,309.771z"})," ",i.jsx("path",{className:"st0",d:"M89.289,361.082c11.158,6.076,20.194,1.967,20.194-9.19c0-11.158-9.036-25.129-20.194-31.21 c-11.157-6.083-20.207-1.968-20.207,9.19C69.081,341.029,78.131,355,89.289,361.082z"})," ",i.jsx("path",{className:"st0",d:"M202.061,422.55c11.158,6.082,20.208,1.967,20.208-9.191c0-11.151-9.05-25.128-20.208-31.21 c-11.15-6.076-20.194-1.961-20.194,9.19C181.867,402.497,190.911,416.468,202.061,422.55z"})," ",i.jsx("path",{className:"st0",d:"M145.675,335.424c11.158,6.082,20.201,1.967,20.201-9.191c0-11.151-9.044-25.128-20.201-31.204 c-11.158-6.082-20.201-1.967-20.201,9.185C125.474,315.37,134.517,329.341,145.675,335.424z"})," ",i.jsx("path",{className:"st0",d:"M418.341,207.902c-11.158,6.082-20.208,20.053-20.208,31.21c0,11.151,9.05,15.273,20.208,9.19 c11.144-6.082,20.194-20.059,20.194-31.21C438.535,205.935,429.486,201.819,418.341,207.902z"})," ",i.jsx("path",{className:"st0",d:"M305.555,382.149c-11.158,6.082-20.194,20.059-20.194,31.21c0,11.158,9.036,15.273,20.194,9.191 c11.158-6.082,20.194-20.053,20.194-31.211C325.749,380.188,316.714,376.074,305.555,382.149z"})," ",i.jsx("path",{className:"st0",d:"M361.948,295.028c-11.158,6.076-20.207,20.053-20.207,31.204c0,11.158,9.05,15.273,20.207,9.191 c11.158-6.083,20.194-20.053,20.194-31.21C382.142,293.062,373.106,288.947,361.948,295.028z"})," "]})," "]})]})}function dt({name:e,inputProps:t}){return i.jsxs(vt,{children:[i.jsx(xt,{asChild:!0,children:i.jsx(oa,{...t,name:e,className:L("h-[32px]","w-[60px]",{"bg-stat-red/10 dark:bg-stat-red-dark/5":e==="health"||e==="maxHealth","bg-stat-green/10 dark:bg-stat-green-dark/5":e==="tempHealth","bg-stat-blue/10 dark:bg-stat-blue-dark/5":e==="armorClass"},t==null?void 0:t.className)})}),i.jsx(bt,{children:i.jsx("p",{children:Vi(e)})})]})}const Vi=e=>{switch(e){case"health":return"Current Hit Points";case"maxHealth":return"Hit Points Maximum";case"tempHealth":return"Temporary Hit Points";case"armorClass":return"Armor Class"}};function vn({label:e,buttonProps:t}){return i.jsx(Ce,{className:"w-full",variant:"secondary",...t,children:e},e)}var Wi=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ui=Wi.reduce((e,t)=>{const n=ea(`Primitive.${t}`),r=a.forwardRef((o,s)=>{const{asChild:c,...l}=o,u=c?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(u,{...l,ref:s})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),Ki="Separator",Rr="horizontal",Gi=["horizontal","vertical"],vo=a.forwardRef((e,t)=>{const{decorative:n,orientation:r=Rr,...o}=e,s=Yi(r)?r:Rr,l=n?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return i.jsx(Ui.div,{"data-orientation":s,...l,...o,ref:t})});vo.displayName=Ki;function Yi(e){return Gi.includes(e)}var xo=vo;const Vt=a.forwardRef(({className:e,orientation:t="horizontal",decorative:n=!0,...r},o)=>i.jsx(xo,{ref:o,decorative:n,orientation:t,className:L("bg-mirage-200 dark:bg-mirage-800 shrink-0",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...r}));Vt.displayName=xo.displayName;const Xi=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-check size-5",children:i.jsx("path",{d:"M20 6 9 17l-5-5"})}),qi=()=>i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-dices size-5",children:[i.jsx("rect",{width:"12",height:"12",x:"2",y:"10",rx:"2",ry:"2"}),i.jsx("path",{d:"m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6"}),i.jsx("path",{d:"M6 18h.01"}),i.jsx("path",{d:"M10 14h.01"}),i.jsx("path",{d:"M15 6h.01"}),i.jsx("path",{d:"M18 9h.01"})]}),Zi=()=>i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-equal size-5",children:[i.jsx("line",{x1:"5",x2:"19",y1:"9",y2:"9"}),i.jsx("line",{x1:"5",x2:"19",y1:"15",y2:"15"})]});function Qi({appState:e,dispatch:t,tokens:n,playerRole:r,playerName:o}){const[s,c]=a.useState(!1),l=p=>{switch(p){case"damage":return i.jsx(vn,{label:"Apply Damage",buttonProps:{onClick:()=>{dr(e.value?-1*e.value:0,e.includedItems,e.damageScaleOptions,n),t({type:"set-operation",operation:"none"})}}});case"healing":return i.jsx(vn,{label:"Apply Healing",buttonProps:{onClick:()=>{dr(e.value?e.value:0,e.includedItems,e.damageScaleOptions,n),t({type:"set-operation",operation:"none"})}}});case"overwrite":return i.jsx(vn,{label:"Overwrite",buttonProps:{onClick:()=>{fa(e.statOverwrites,e.includedItems,n),t({type:"clear-stat-overwrites"}),t({type:"set-operation",operation:"none"})}}});default:return i.jsx(i.Fragment,{})}},u=e.rolls.filter(p=>p.visibility==="PUBLIC"||p.visibility==="GM"&&r==="GM"||p.visibility==="PRIVATE"&&ee.player.id===p.playerId).map(p=>{const S=p.roll,f=S.substring(0,S.indexOf(":")),b=S.substring(S.indexOf(":")+1,S.indexOf(" =")),v=`${p.playerName} rolled `;return i.jsxs("div",{className:"flex w-full flex-col gap-2 overflow-clip rounded-lg border border-mirage-300 bg-mirage-100 p-2 text-sm shadow-sm dark:border-none dark:bg-mirage-900",children:[i.jsxs("div",{className:"",children:[p.visibility==="GM"&&i.jsx("div",{className:"float-end pr-0.5",children:"GM"}),p.visibility==="PRIVATE"&&i.jsx("div",{className:"float-end pr-0.5",children:"Private"}),i.jsxs("p",{className:"flex flex-wrap items-center gap-x-1",children:[i.jsx("span",{className:"text-mirage-500 dark:text-mirage-400",children:v}),i.jsx("span",{children:`${f}`})]})]}),i.jsx(Vt,{}),i.jsx("div",{className:"flex w-full justify-center text-mirage-500 dark:text-mirage-400",children:` ${b}`}),i.jsxs("div",{className:"flex w-full justify-between gap-2",children:[i.jsxs("div",{className:"flex w-full rounded-md border border-mirage-300 bg-slate-50 px-2 font-light dark:border-none dark:bg-mirage-950",children:[i.jsx("span",{className:"ml-auto flex items-center justify-center text-2xl text-mirage-500 dark:text-mirage-400",children:i.jsx(Zi,{})}),i.jsx("span",{className:"ml-auto flex grow items-center justify-center text-lg",children:`${p.total}`})]}),i.jsxs(vt,{defaultOpen:!1,children:[i.jsx(xt,{asChild:!0,children:i.jsx(Ce,{variant:"outline",size:"icon",className:"shrink-0",onClick:()=>{const g=S.substring(0,S.indexOf(":"));t(p.visibility==="PRIVATE"?{type:"add-roll",diceExpression:g,playerName:o,visibility:p.visibility,dispatch:t,playerId:p.playerId}:{type:"add-roll",diceExpression:g,playerName:o,visibility:p.visibility,dispatch:t}),c(!1)},children:i.jsx(qi,{})})}),i.jsx(bt,{children:i.jsx("p",{children:"Roll Again"})})]}),i.jsxs(vt,{children:[i.jsx(xt,{asChild:!0,children:i.jsx(Ce,{variant:"secondary",size:"icon",className:"shrink-0",onClick:()=>{t({type:"set-value",value:p.total}),c(!1)},children:i.jsx(Xi,{})})}),i.jsx(bt,{children:i.jsx("p",{children:"Use Roll"})})]})]})]},p.timeStamp)});let d="Make a roll";if(e.value!==null)switch(e.operation){case"none":case"overwrite":d="Roll Result";break;case"damage":d="Damage Result";break;case"healing":d="Healing Result";break}const h=60,[m,w]=a.useState(window.innerHeight-h);return a.useEffect(()=>{const p=()=>w(window.innerHeight-h);return window.addEventListener("resize",p),window.removeEventListener("resize",p)},[]),i.jsxs("div",{className:"space-y-2 p-2 px-4",children:[e.operation==="overwrite"&&i.jsxs("div",{className:"grid grid-cols-2 items-center justify-items-stretch gap-2 border-mirage-300 dark:border-mirage-800 sm:grid-cols-4",children:[i.jsx(dt,{name:"health",inputProps:{value:e.statOverwrites.hitPoints,onChange:p=>t({type:"set-hit-points-overwrite",hitPointsOverwrite:p.target.value}),onBlur:p=>t({type:"set-hit-points-overwrite",hitPointsOverwrite:Ot(p.target.value)}),className:"min-w-[90px] w-full h-[36px]",placeholder:"Unchanged"}}),i.jsx(dt,{name:"maxHealth",inputProps:{value:e.statOverwrites.maxHitPoints,onChange:p=>t({type:"set-max-hit-points-overwrite",maxHitPointsOverwrite:p.target.value}),onBlur:p=>t({type:"set-max-hit-points-overwrite",maxHitPointsOverwrite:Ot(p.target.value)}),className:"min-w-[90px] w-full h-[36px]",placeholder:"Unchanged"}}),i.jsx(dt,{name:"tempHealth",inputProps:{value:e.statOverwrites.tempHitPoints,onChange:p=>t({type:"set-temp-hit-points-overwrite",tempHitPointsOverwrite:p.target.value}),onBlur:p=>t({type:"set-temp-hit-points-overwrite",tempHitPointsOverwrite:Ot(p.target.value)}),className:"min-w-[90px] w-full h-[36px]",placeholder:"Unchanged"}}),i.jsx(dt,{name:"armorClass",inputProps:{value:e.statOverwrites.armorClass,onChange:p=>t({type:"set-armor-class-overwrite",armorClassOverwrite:p.target.value}),onBlur:p=>t({type:"set-armor-class-overwrite",armorClassOverwrite:Ot(p.target.value)}),className:"min-w-[90px] w-full h-[36px]",placeholder:"Unchanged"}})]}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsxs(Fi,{open:s,onOpenChange:c,children:[i.jsx(zi,{asChild:!0,children:i.jsx(Ce,{variant:"outline",children:"Roll Log"})}),i.jsx(go,{className:"w-72 p-0",align:"start",style:{height:m},children:i.jsx(_n,{className:"h-full px-4",children:i.jsxs("div",{className:"flex flex-col gap-2 py-3",children:[i.jsx("button",{className:"absolute size-0",name:"root, does nothing"}),i.jsx("h4",{className:"font-medium",children:"Scene Roll Log"}),i.jsx(Vt,{}),e.rolls.length>0?i.jsx("div",{className:"flex flex-col justify-start gap-2",children:u}):i.jsx("p",{className:"text-muted-foreground text-sm",children:"Your last 20 dice rolls, made in this scene, will be available here."})]})})})]}),i.jsxs("div",{className:"flex h-9 self-start rounded-md border border-mirage-300 text-sm font-medium dark:border-mirage-800",children:[i.jsxs("div",{className:"flex h-full w-10 min-w-12 items-center justify-center rounded-l-md border-r border-mirage-300 bg-mirage-50 p-2 px-4 text-lg dark:border-mirage-800 dark:bg-mirage-950",children:[e.animateRoll&&i.jsx("div",{className:"absolute animate-inverse-bounce",children:i.jsx($i,{})}),!e.animateRoll&&i.jsx("div",{children:e.value?Wr(3,e.value):""})]}),i.jsx("div",{className:"flex h-full items-center justify-center rounded-md p-2 px-4",children:d})]}),e.operation!=="none"&&i.jsx("div",{className:"ml-auto w-full md:w-fit",children:l(e.operation)})]})]})}const Ot=e=>{const t=Math.trunc(parseFloat(e));return Number.isNaN(t)?"":t.toString()};function Ue(e,t){if(e==null)return{};var n={},r=Object.keys(e),o,s;for(s=0;s<r.length;s++)o=r[s],!(t.indexOf(o)>=0)&&(n[o]=e[o]);return n}var Ji=["color"],el=a.forwardRef(function(e,t){var n=e.color,r=n===void 0?"currentColor":n,o=Ue(e,Ji);return a.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},o,{ref:t}),a.createElement("path",{d:"M6.85355 3.14645C7.04882 3.34171 7.04882 3.65829 6.85355 3.85355L3.70711 7H12.5C12.7761 7 13 7.22386 13 7.5C13 7.77614 12.7761 8 12.5 8H3.70711L6.85355 11.1464C7.04882 11.3417 7.04882 11.6583 6.85355 11.8536C6.65829 12.0488 6.34171 12.0488 6.14645 11.8536L2.14645 7.85355C1.95118 7.65829 1.95118 7.34171 2.14645 7.14645L6.14645 3.14645C6.34171 2.95118 6.65829 2.95118 6.85355 3.14645Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))}),tl=["color"],nl=a.forwardRef(function(e,t){var n=e.color,r=n===void 0?"currentColor":n,o=Ue(e,tl);return a.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},o,{ref:t}),a.createElement("path",{d:"M8.14645 3.14645C8.34171 2.95118 8.65829 2.95118 8.85355 3.14645L12.8536 7.14645C13.0488 7.34171 13.0488 7.65829 12.8536 7.85355L8.85355 11.8536C8.65829 12.0488 8.34171 12.0488 8.14645 11.8536C7.95118 11.6583 7.95118 11.3417 8.14645 11.1464L11.2929 8H2.5C2.22386 8 2 7.77614 2 7.5C2 7.22386 2.22386 7 2.5 7H11.2929L8.14645 3.85355C7.95118 3.65829 7.95118 3.34171 8.14645 3.14645Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))}),rl=["color"],ol=a.forwardRef(function(e,t){var n=e.color,r=n===void 0?"currentColor":n,o=Ue(e,rl);return a.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},o,{ref:t}),a.createElement("path",{d:"M4.93179 5.43179C4.75605 5.60753 4.75605 5.89245 4.93179 6.06819C5.10753 6.24392 5.39245 6.24392 5.56819 6.06819L7.49999 4.13638L9.43179 6.06819C9.60753 6.24392 9.89245 6.24392 10.0682 6.06819C10.2439 5.89245 10.2439 5.60753 10.0682 5.43179L7.81819 3.18179C7.73379 3.0974 7.61933 3.04999 7.49999 3.04999C7.38064 3.04999 7.26618 3.0974 7.18179 3.18179L4.93179 5.43179ZM10.0682 9.56819C10.2439 9.39245 10.2439 9.10753 10.0682 8.93179C9.89245 8.75606 9.60753 8.75606 9.43179 8.93179L7.49999 10.8636L5.56819 8.93179C5.39245 8.75606 5.10753 8.75606 4.93179 8.93179C4.75605 9.10753 4.75605 9.39245 4.93179 9.56819L7.18179 11.8182C7.35753 11.9939 7.64245 11.9939 7.81819 11.8182L10.0682 9.56819Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))}),sl=["color"],bo=a.forwardRef(function(e,t){var n=e.color,r=n===void 0?"currentColor":n,o=Ue(e,sl);return a.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},o,{ref:t}),a.createElement("path",{d:"M11.4669 3.72684C11.7558 3.91574 11.8369 4.30308 11.648 4.59198L7.39799 11.092C7.29783 11.2452 7.13556 11.3467 6.95402 11.3699C6.77247 11.3931 6.58989 11.3355 6.45446 11.2124L3.70446 8.71241C3.44905 8.48022 3.43023 8.08494 3.66242 7.82953C3.89461 7.57412 4.28989 7.55529 4.5453 7.78749L6.75292 9.79441L10.6018 3.90792C10.7907 3.61902 11.178 3.53795 11.4669 3.72684Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))}),al=["color"],il=a.forwardRef(function(e,t){var n=e.color,r=n===void 0?"currentColor":n,o=Ue(e,al);return a.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},o,{ref:t}),a.createElement("path",{d:"M3.13523 6.15803C3.3241 5.95657 3.64052 5.94637 3.84197 6.13523L7.5 9.56464L11.158 6.13523C11.3595 5.94637 11.6759 5.95657 11.8648 6.15803C12.0536 6.35949 12.0434 6.67591 11.842 6.86477L7.84197 10.6148C7.64964 10.7951 7.35036 10.7951 7.15803 10.6148L3.15803 6.86477C2.95657 6.67591 2.94637 6.35949 3.13523 6.15803Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))}),ll=["color"],cl=a.forwardRef(function(e,t){var n=e.color,r=n===void 0?"currentColor":n,o=Ue(e,ll);return a.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},o,{ref:t}),a.createElement("path",{d:"M3.13523 8.84197C3.3241 9.04343 3.64052 9.05363 3.84197 8.86477L7.5 5.43536L11.158 8.86477C11.3595 9.05363 11.6759 9.04343 11.8648 8.84197C12.0536 8.64051 12.0434 8.32409 11.842 8.13523L7.84197 4.38523C7.64964 4.20492 7.35036 4.20492 7.15803 4.38523L3.15803 8.13523C2.95657 8.32409 2.94637 8.64051 3.13523 8.84197Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))}),ul=["color"],dl=a.forwardRef(function(e,t){var n=e.color,r=n===void 0?"currentColor":n,o=Ue(e,ul);return a.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},o,{ref:t}),a.createElement("path",{d:"M7.07095 0.650238C6.67391 0.650238 6.32977 0.925096 6.24198 1.31231L6.0039 2.36247C5.6249 2.47269 5.26335 2.62363 4.92436 2.81013L4.01335 2.23585C3.67748 2.02413 3.23978 2.07312 2.95903 2.35386L2.35294 2.95996C2.0722 3.2407 2.0232 3.6784 2.23493 4.01427L2.80942 4.92561C2.62307 5.2645 2.47227 5.62594 2.36216 6.00481L1.31209 6.24287C0.924883 6.33065 0.650024 6.6748 0.650024 7.07183V7.92897C0.650024 8.32601 0.924883 8.67015 1.31209 8.75794L2.36228 8.99603C2.47246 9.375 2.62335 9.73652 2.80979 10.0755L2.2354 10.9867C2.02367 11.3225 2.07267 11.7602 2.35341 12.041L2.95951 12.6471C3.24025 12.9278 3.67795 12.9768 4.01382 12.7651L4.92506 12.1907C5.26384 12.377 5.62516 12.5278 6.0039 12.6379L6.24198 13.6881C6.32977 14.0753 6.67391 14.3502 7.07095 14.3502H7.92809C8.32512 14.3502 8.66927 14.0753 8.75705 13.6881L8.99505 12.6383C9.37411 12.5282 9.73573 12.3773 10.0748 12.1909L10.986 12.7653C11.3218 12.977 11.7595 12.928 12.0403 12.6473L12.6464 12.0412C12.9271 11.7604 12.9761 11.3227 12.7644 10.9869L12.1902 10.076C12.3768 9.73688 12.5278 9.37515 12.638 8.99596L13.6879 8.75794C14.0751 8.67015 14.35 8.32601 14.35 7.92897V7.07183C14.35 6.6748 14.0751 6.33065 13.6879 6.24287L12.6381 6.00488C12.528 5.62578 12.3771 5.26414 12.1906 4.92507L12.7648 4.01407C12.9766 3.6782 12.9276 3.2405 12.6468 2.95975L12.0407 2.35366C11.76 2.07292 11.3223 2.02392 10.9864 2.23565L10.0755 2.80989C9.73622 2.62328 9.37437 2.47229 8.99505 2.36209L8.75705 1.31231C8.66927 0.925096 8.32512 0.650238 7.92809 0.650238H7.07095ZM4.92053 3.81251C5.44724 3.44339 6.05665 3.18424 6.71543 3.06839L7.07095 1.50024H7.92809L8.28355 3.06816C8.94267 3.18387 9.5524 3.44302 10.0794 3.81224L11.4397 2.9547L12.0458 3.56079L11.1882 4.92117C11.5573 5.44798 11.8164 6.0575 11.9321 6.71638L13.5 7.07183V7.92897L11.932 8.28444C11.8162 8.94342 11.557 9.55301 11.1878 10.0798L12.0453 11.4402L11.4392 12.0462L10.0787 11.1886C9.55192 11.5576 8.94241 11.8166 8.28355 11.9323L7.92809 13.5002H7.07095L6.71543 11.932C6.0569 11.8162 5.44772 11.5572 4.92116 11.1883L3.56055 12.046L2.95445 11.4399L3.81213 10.0794C3.4431 9.55266 3.18403 8.94326 3.06825 8.2845L1.50002 7.92897V7.07183L3.06818 6.71632C3.18388 6.05765 3.44283 5.44833 3.81171 4.92165L2.95398 3.561L3.56008 2.95491L4.92053 3.81251ZM9.02496 7.50008C9.02496 8.34226 8.34223 9.02499 7.50005 9.02499C6.65786 9.02499 5.97513 8.34226 5.97513 7.50008C5.97513 6.65789 6.65786 5.97516 7.50005 5.97516C8.34223 5.97516 9.02496 6.65789 9.02496 7.50008ZM9.92496 7.50008C9.92496 8.83932 8.83929 9.92499 7.50005 9.92499C6.1608 9.92499 5.07513 8.83932 5.07513 7.50008C5.07513 6.16084 6.1608 5.07516 7.50005 5.07516C8.83929 5.07516 9.92496 6.16084 9.92496 7.50008Z",fill:r,fillRule:"evenodd",clipRule:"evenodd"}))});function fl(e){const t=hl(e),n=a.forwardRef((r,o)=>{const{children:s,...c}=r,l=a.Children.toArray(s),u=l.find(ml);if(u){const d=u.props.children,h=l.map(m=>m===u?a.Children.count(d)>1?a.Children.only(null):a.isValidElement(d)?d.props.children:null:m);return i.jsx(t,{...c,ref:o,children:a.isValidElement(d)?a.cloneElement(d,void 0,h):null})}return i.jsx(t,{...c,ref:o,children:s})});return n.displayName=`${e}.Slot`,n}function hl(e){const t=a.forwardRef((n,r)=>{const{children:o,...s}=n;if(a.isValidElement(o)){const c=vl(o),l=gl(s,o.props);return o.type!==a.Fragment&&(l.ref=r?Hr(r,c):c),a.cloneElement(o,l)}return a.Children.count(o)>1?a.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var pl=Symbol("radix.slottable");function ml(e){return a.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===pl}function gl(e,t){const n={...t};for(const r in t){const o=e[r],s=t[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...l)=>{const u=s(...l);return o(...l),u}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...e,...n}}function vl(e){var r,o;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function wo(e){const t=a.useRef({value:e,previous:e});return a.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var xl=[" ","Enter","ArrowUp","ArrowDown"],bl=[" ","Enter"],Ve="Select",[Jt,en,wl]=aa(Ve),[rt]=Ln(Ve,[wl,qt]),tn=qt(),[yl,Be]=rt(Ve),[Cl,Sl]=rt(Ve),yo=e=>{const{__scopeSelect:t,children:n,open:r,defaultOpen:o,onOpenChange:s,value:c,defaultValue:l,onValueChange:u,dir:d,name:h,autoComplete:m,disabled:w,required:p,form:S}=e,f=tn(t),[b,v]=a.useState(null),[g,x]=a.useState(null),[y,C]=a.useState(!1),E=sa(d),[R,j]=$t({prop:r,defaultProp:o??!1,onChange:s,caller:Ve}),[D,P]=$t({prop:c,defaultProp:l,onChange:u,caller:Ve}),T=a.useRef(null),_=b?S||!!b.closest("form"):!0,[z,$]=a.useState(new Set),J=Array.from(z).map(W=>W.props.value).join(";");return i.jsx(Fr,{...f,children:i.jsxs(yl,{required:p,scope:t,trigger:b,onTriggerChange:v,valueNode:g,onValueNodeChange:x,valueNodeHasChildren:y,onValueNodeHasChildrenChange:C,contentId:Xt(),value:D,onValueChange:P,open:R,onOpenChange:j,dir:E,triggerPointerDownPosRef:T,disabled:w,children:[i.jsx(Jt.Provider,{scope:t,children:i.jsx(Cl,{scope:e.__scopeSelect,onNativeOptionAdd:a.useCallback(W=>{$(B=>new Set(B).add(W))},[]),onNativeOptionRemove:a.useCallback(W=>{$(B=>{const ne=new Set(B);return ne.delete(W),ne})},[]),children:n})}),_?i.jsxs(Ko,{"aria-hidden":!0,required:p,tabIndex:-1,name:h,autoComplete:m,value:D,onChange:W=>P(W.target.value),disabled:w,form:S,children:[D===void 0?i.jsx("option",{value:""}):null,Array.from(z)]},J):null]})})};yo.displayName=Ve;var Co="SelectTrigger",So=a.forwardRef((e,t)=>{const{__scopeSelect:n,disabled:r=!1,...o}=e,s=tn(n),c=Be(Co,n),l=c.disabled||r,u=te(t,c.onTriggerChange),d=en(n),h=a.useRef("touch"),[m,w,p]=Yo(f=>{const b=d().filter(x=>!x.disabled),v=b.find(x=>x.value===c.value),g=Xo(b,f,v);g!==void 0&&c.onValueChange(g.value)}),S=f=>{l||(c.onOpenChange(!0),p()),f&&(c.triggerPointerDownPosRef.current={x:Math.round(f.pageX),y:Math.round(f.pageY)})};return i.jsx(On,{asChild:!0,...s,children:i.jsx(V.button,{type:"button",role:"combobox","aria-controls":c.contentId,"aria-expanded":c.open,"aria-required":c.required,"aria-autocomplete":"none",dir:c.dir,"data-state":c.open?"open":"closed",disabled:l,"data-disabled":l?"":void 0,"data-placeholder":Go(c.value)?"":void 0,...o,ref:u,onClick:H(o.onClick,f=>{f.currentTarget.focus(),h.current!=="mouse"&&S(f)}),onPointerDown:H(o.onPointerDown,f=>{h.current=f.pointerType;const b=f.target;b.hasPointerCapture(f.pointerId)&&b.releasePointerCapture(f.pointerId),f.button===0&&f.ctrlKey===!1&&f.pointerType==="mouse"&&(S(f),f.preventDefault())}),onKeyDown:H(o.onKeyDown,f=>{const b=m.current!=="";!(f.ctrlKey||f.altKey||f.metaKey)&&f.key.length===1&&w(f.key),!(b&&f.key===" ")&&xl.includes(f.key)&&(S(),f.preventDefault())})})})});So.displayName=Co;var Ro="SelectValue",Eo=a.forwardRef((e,t)=>{const{__scopeSelect:n,className:r,style:o,children:s,placeholder:c="",...l}=e,u=Be(Ro,n),{onValueNodeHasChildrenChange:d}=u,h=s!==void 0,m=te(t,u.onValueNodeChange);return Ie(()=>{d(h)},[d,h]),i.jsx(V.span,{...l,ref:m,style:{pointerEvents:"none"},children:Go(u.value)?i.jsx(i.Fragment,{children:c}):s})});Eo.displayName=Ro;var Rl="SelectIcon",No=a.forwardRef((e,t)=>{const{__scopeSelect:n,children:r,...o}=e;return i.jsx(V.span,{"aria-hidden":!0,...o,ref:t,children:r||""})});No.displayName=Rl;var El="SelectPortal",jo=e=>i.jsx(Hn,{asChild:!0,...e});jo.displayName=El;var We="SelectContent",Io=a.forwardRef((e,t)=>{const n=Be(We,e.__scopeSelect),[r,o]=a.useState();if(Ie(()=>{o(new DocumentFragment)},[]),!n.open){const s=r;return s?ze.createPortal(i.jsx(To,{scope:e.__scopeSelect,children:i.jsx(Jt.Slot,{scope:e.__scopeSelect,children:i.jsx("div",{children:e.children})})}),s):null}return i.jsx(Po,{...e,ref:t})});Io.displayName=We;var pe=10,[To,He]=rt(We),Nl="SelectContentImpl",jl=fl("SelectContent.RemoveScroll"),Po=a.forwardRef((e,t)=>{const{__scopeSelect:n,position:r="item-aligned",onCloseAutoFocus:o,onEscapeKeyDown:s,onPointerDownOutside:c,side:l,sideOffset:u,align:d,alignOffset:h,arrowPadding:m,collisionBoundary:w,collisionPadding:p,sticky:S,hideWhenDetached:f,avoidCollisions:b,...v}=e,g=Be(We,n),[x,y]=a.useState(null),[C,E]=a.useState(null),R=te(t,I=>y(I)),[j,D]=a.useState(null),[P,T]=a.useState(null),_=en(n),[z,$]=a.useState(!1),J=a.useRef(!1);a.useEffect(()=>{if(x)return qr(x)},[x]),Gr();const W=a.useCallback(I=>{const[M,...F]=_().map(k=>k.ref.current),[N]=F.slice(-1),O=document.activeElement;for(const k of I)if(k===O||(k==null||k.scrollIntoView({block:"nearest"}),k===M&&C&&(C.scrollTop=0),k===N&&C&&(C.scrollTop=C.scrollHeight),k==null||k.focus(),document.activeElement!==O))return},[_,C]),B=a.useCallback(()=>W([j,x]),[W,j,x]);a.useEffect(()=>{z&&B()},[z,B]);const{onOpenChange:ne,triggerPointerDownPosRef:K}=g;a.useEffect(()=>{if(x){let I={x:0,y:0};const M=N=>{var O,k;I={x:Math.abs(Math.round(N.pageX)-(((O=K.current)==null?void 0:O.x)??0)),y:Math.abs(Math.round(N.pageY)-(((k=K.current)==null?void 0:k.y)??0))}},F=N=>{I.x<=10&&I.y<=10?N.preventDefault():x.contains(N.target)||ne(!1),document.removeEventListener("pointermove",M),K.current=null};return K.current!==null&&(document.addEventListener("pointermove",M),document.addEventListener("pointerup",F,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",M),document.removeEventListener("pointerup",F,{capture:!0})}}},[x,ne,K]),a.useEffect(()=>{const I=()=>ne(!1);return window.addEventListener("blur",I),window.addEventListener("resize",I),()=>{window.removeEventListener("blur",I),window.removeEventListener("resize",I)}},[ne]);const[Re,Ee]=Yo(I=>{const M=_().filter(O=>!O.disabled),F=M.find(O=>O.ref.current===document.activeElement),N=Xo(M,I,F);N&&setTimeout(()=>N.ref.current.focus())}),G=a.useCallback((I,M,F)=>{const N=!J.current&&!F;(g.value!==void 0&&g.value===M||N)&&(D(I),N&&(J.current=!0))},[g.value]),ie=a.useCallback(()=>x==null?void 0:x.focus(),[x]),re=a.useCallback((I,M,F)=>{const N=!J.current&&!F;(g.value!==void 0&&g.value===M||N)&&T(I)},[g.value]),ge=r==="popper"?Rn:Do,Y=ge===Rn?{side:l,sideOffset:u,align:d,alignOffset:h,arrowPadding:m,collisionBoundary:w,collisionPadding:p,sticky:S,hideWhenDetached:f,avoidCollisions:b}:{};return i.jsx(To,{scope:n,content:x,viewport:C,onViewportChange:E,itemRefCallback:G,selectedItem:j,onItemLeave:ie,itemTextRefCallback:re,focusSelectedItem:B,selectedItemText:P,position:r,isPositioned:z,searchRef:Re,children:i.jsx(zn,{as:jl,allowPinchZoom:!0,children:i.jsx(Fn,{asChild:!0,trapped:g.open,onMountAutoFocus:I=>{I.preventDefault()},onUnmountAutoFocus:H(o,I=>{var M;(M=g.trigger)==null||M.focus({preventScroll:!0}),I.preventDefault()}),children:i.jsx(zr,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:s,onPointerDownOutside:c,onFocusOutside:I=>I.preventDefault(),onDismiss:()=>g.onOpenChange(!1),children:i.jsx(ge,{role:"listbox",id:g.contentId,"data-state":g.open?"open":"closed",dir:g.dir,onContextMenu:I=>I.preventDefault(),...v,...Y,onPlaced:()=>$(!0),ref:R,style:{display:"flex",flexDirection:"column",outline:"none",...v.style},onKeyDown:H(v.onKeyDown,I=>{const M=I.ctrlKey||I.altKey||I.metaKey;if(I.key==="Tab"&&I.preventDefault(),!M&&I.key.length===1&&Ee(I.key),["ArrowUp","ArrowDown","Home","End"].includes(I.key)){let N=_().filter(O=>!O.disabled).map(O=>O.ref.current);if(["ArrowUp","End"].includes(I.key)&&(N=N.slice().reverse()),["ArrowUp","ArrowDown"].includes(I.key)){const O=I.target,k=N.indexOf(O);N=N.slice(k+1)}setTimeout(()=>W(N)),I.preventDefault()}})})})})})})});Po.displayName=Nl;var Il="SelectItemAlignedPosition",Do=a.forwardRef((e,t)=>{const{__scopeSelect:n,onPlaced:r,...o}=e,s=Be(We,n),c=He(We,n),[l,u]=a.useState(null),[d,h]=a.useState(null),m=te(t,R=>h(R)),w=en(n),p=a.useRef(!1),S=a.useRef(!0),{viewport:f,selectedItem:b,selectedItemText:v,focusSelectedItem:g}=c,x=a.useCallback(()=>{if(s.trigger&&s.valueNode&&l&&d&&f&&b&&v){const R=s.trigger.getBoundingClientRect(),j=d.getBoundingClientRect(),D=s.valueNode.getBoundingClientRect(),P=v.getBoundingClientRect();if(s.dir!=="rtl"){const O=P.left-j.left,k=D.left-O,oe=R.left-k,q=R.width+oe,ve=Math.max(q,j.width),xe=window.innerWidth-pe,Ke=ur(k,[pe,Math.max(pe,xe-ve)]);l.style.minWidth=q+"px",l.style.left=Ke+"px"}else{const O=j.right-P.right,k=window.innerWidth-D.right-O,oe=window.innerWidth-R.right-k,q=R.width+oe,ve=Math.max(q,j.width),xe=window.innerWidth-pe,Ke=ur(k,[pe,Math.max(pe,xe-ve)]);l.style.minWidth=q+"px",l.style.right=Ke+"px"}const T=w(),_=window.innerHeight-pe*2,z=f.scrollHeight,$=window.getComputedStyle(d),J=parseInt($.borderTopWidth,10),W=parseInt($.paddingTop,10),B=parseInt($.borderBottomWidth,10),ne=parseInt($.paddingBottom,10),K=J+W+z+ne+B,Re=Math.min(b.offsetHeight*5,K),Ee=window.getComputedStyle(f),G=parseInt(Ee.paddingTop,10),ie=parseInt(Ee.paddingBottom,10),re=R.top+R.height/2-pe,ge=_-re,Y=b.offsetHeight/2,I=b.offsetTop+Y,M=J+W+I,F=K-M;if(M<=re){const O=T.length>0&&b===T[T.length-1].ref.current;l.style.bottom="0px";const k=d.clientHeight-f.offsetTop-f.offsetHeight,oe=Math.max(ge,Y+(O?ie:0)+k+B),q=M+oe;l.style.height=q+"px"}else{const O=T.length>0&&b===T[0].ref.current;l.style.top="0px";const oe=Math.max(re,J+f.offsetTop+(O?G:0)+Y)+F;l.style.height=oe+"px",f.scrollTop=M-re+f.offsetTop}l.style.margin=`${pe}px 0`,l.style.minHeight=Re+"px",l.style.maxHeight=_+"px",r==null||r(),requestAnimationFrame(()=>p.current=!0)}},[w,s.trigger,s.valueNode,l,d,f,b,v,s.dir,r]);Ie(()=>x(),[x]);const[y,C]=a.useState();Ie(()=>{d&&C(window.getComputedStyle(d).zIndex)},[d]);const E=a.useCallback(R=>{R&&S.current===!0&&(x(),g==null||g(),S.current=!1)},[x,g]);return i.jsx(Pl,{scope:n,contentWrapper:l,shouldExpandOnScrollRef:p,onScrollButtonChange:E,children:i.jsx("div",{ref:u,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:y},children:i.jsx(V.div,{...o,ref:m,style:{boxSizing:"border-box",maxHeight:"100%",...o.style}})})})});Do.displayName=Il;var Tl="SelectPopperPosition",Rn=a.forwardRef((e,t)=>{const{__scopeSelect:n,align:r="start",collisionPadding:o=pe,...s}=e,c=tn(n);return i.jsx($r,{...c,...s,ref:t,align:r,collisionPadding:o,style:{boxSizing:"border-box",...s.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Rn.displayName=Tl;var[Pl,Vn]=rt(We,{}),En="SelectViewport",ko=a.forwardRef((e,t)=>{const{__scopeSelect:n,nonce:r,...o}=e,s=He(En,n),c=Vn(En,n),l=te(t,s.onViewportChange),u=a.useRef(0);return i.jsxs(i.Fragment,{children:[i.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),i.jsx(Jt.Slot,{scope:n,children:i.jsx(V.div,{"data-radix-select-viewport":"",role:"presentation",...o,ref:l,style:{position:"relative",flex:1,overflow:"hidden auto",...o.style},onScroll:H(o.onScroll,d=>{const h=d.currentTarget,{contentWrapper:m,shouldExpandOnScrollRef:w}=c;if(w!=null&&w.current&&m){const p=Math.abs(u.current-h.scrollTop);if(p>0){const S=window.innerHeight-pe*2,f=parseFloat(m.style.minHeight),b=parseFloat(m.style.height),v=Math.max(f,b);if(v<S){const g=v+p,x=Math.min(S,g),y=g-x;m.style.height=x+"px",m.style.bottom==="0px"&&(h.scrollTop=y>0?y:0,m.style.justifyContent="flex-end")}}}u.current=h.scrollTop})})})]})});ko.displayName=En;var Mo="SelectGroup",[Dl,kl]=rt(Mo),Oo=a.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e,o=Xt();return i.jsx(Dl,{scope:n,id:o,children:i.jsx(V.div,{role:"group","aria-labelledby":o,...r,ref:t})})});Oo.displayName=Mo;var Ao="SelectLabel",Lo=a.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e,o=kl(Ao,n);return i.jsx(V.div,{id:o.id,...r,ref:t})});Lo.displayName=Ao;var Wt="SelectItem",[Ml,_o]=rt(Wt),Bo=a.forwardRef((e,t)=>{const{__scopeSelect:n,value:r,disabled:o=!1,textValue:s,...c}=e,l=Be(Wt,n),u=He(Wt,n),d=l.value===r,[h,m]=a.useState(s??""),[w,p]=a.useState(!1),S=te(t,g=>{var x;return(x=u.itemRefCallback)==null?void 0:x.call(u,g,r,o)}),f=Xt(),b=a.useRef("touch"),v=()=>{o||(l.onValueChange(r),l.onOpenChange(!1))};if(r==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return i.jsx(Ml,{scope:n,value:r,disabled:o,textId:f,isSelected:d,onItemTextChange:a.useCallback(g=>{m(x=>x||((g==null?void 0:g.textContent)??"").trim())},[]),children:i.jsx(Jt.ItemSlot,{scope:n,value:r,disabled:o,textValue:h,children:i.jsx(V.div,{role:"option","aria-labelledby":f,"data-highlighted":w?"":void 0,"aria-selected":d&&w,"data-state":d?"checked":"unchecked","aria-disabled":o||void 0,"data-disabled":o?"":void 0,tabIndex:o?void 0:-1,...c,ref:S,onFocus:H(c.onFocus,()=>p(!0)),onBlur:H(c.onBlur,()=>p(!1)),onClick:H(c.onClick,()=>{b.current!=="mouse"&&v()}),onPointerUp:H(c.onPointerUp,()=>{b.current==="mouse"&&v()}),onPointerDown:H(c.onPointerDown,g=>{b.current=g.pointerType}),onPointerMove:H(c.onPointerMove,g=>{var x;b.current=g.pointerType,o?(x=u.onItemLeave)==null||x.call(u):b.current==="mouse"&&g.currentTarget.focus({preventScroll:!0})}),onPointerLeave:H(c.onPointerLeave,g=>{var x;g.currentTarget===document.activeElement&&((x=u.onItemLeave)==null||x.call(u))}),onKeyDown:H(c.onKeyDown,g=>{var y;((y=u.searchRef)==null?void 0:y.current)!==""&&g.key===" "||(bl.includes(g.key)&&v(),g.key===" "&&g.preventDefault())})})})})});Bo.displayName=Wt;var ft="SelectItemText",Ho=a.forwardRef((e,t)=>{const{__scopeSelect:n,className:r,style:o,...s}=e,c=Be(ft,n),l=He(ft,n),u=_o(ft,n),d=Sl(ft,n),[h,m]=a.useState(null),w=te(t,v=>m(v),u.onItemTextChange,v=>{var g;return(g=l.itemTextRefCallback)==null?void 0:g.call(l,v,u.value,u.disabled)}),p=h==null?void 0:h.textContent,S=a.useMemo(()=>i.jsx("option",{value:u.value,disabled:u.disabled,children:p},u.value),[u.disabled,u.value,p]),{onNativeOptionAdd:f,onNativeOptionRemove:b}=d;return Ie(()=>(f(S),()=>b(S)),[f,b,S]),i.jsxs(i.Fragment,{children:[i.jsx(V.span,{id:u.textId,...s,ref:w}),u.isSelected&&c.valueNode&&!c.valueNodeHasChildren?ze.createPortal(s.children,c.valueNode):null]})});Ho.displayName=ft;var Fo="SelectItemIndicator",zo=a.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e;return _o(Fo,n).isSelected?i.jsx(V.span,{"aria-hidden":!0,...r,ref:t}):null});zo.displayName=Fo;var Nn="SelectScrollUpButton",$o=a.forwardRef((e,t)=>{const n=He(Nn,e.__scopeSelect),r=Vn(Nn,e.__scopeSelect),[o,s]=a.useState(!1),c=te(t,r.onScrollButtonChange);return Ie(()=>{if(n.viewport&&n.isPositioned){let l=function(){const d=u.scrollTop>0;s(d)};const u=n.viewport;return l(),u.addEventListener("scroll",l),()=>u.removeEventListener("scroll",l)}},[n.viewport,n.isPositioned]),o?i.jsx(Wo,{...e,ref:c,onAutoScroll:()=>{const{viewport:l,selectedItem:u}=n;l&&u&&(l.scrollTop=l.scrollTop-u.offsetHeight)}}):null});$o.displayName=Nn;var jn="SelectScrollDownButton",Vo=a.forwardRef((e,t)=>{const n=He(jn,e.__scopeSelect),r=Vn(jn,e.__scopeSelect),[o,s]=a.useState(!1),c=te(t,r.onScrollButtonChange);return Ie(()=>{if(n.viewport&&n.isPositioned){let l=function(){const d=u.scrollHeight-u.clientHeight,h=Math.ceil(u.scrollTop)<d;s(h)};const u=n.viewport;return l(),u.addEventListener("scroll",l),()=>u.removeEventListener("scroll",l)}},[n.viewport,n.isPositioned]),o?i.jsx(Wo,{...e,ref:c,onAutoScroll:()=>{const{viewport:l,selectedItem:u}=n;l&&u&&(l.scrollTop=l.scrollTop+u.offsetHeight)}}):null});Vo.displayName=jn;var Wo=a.forwardRef((e,t)=>{const{__scopeSelect:n,onAutoScroll:r,...o}=e,s=He("SelectScrollButton",n),c=a.useRef(null),l=en(n),u=a.useCallback(()=>{c.current!==null&&(window.clearInterval(c.current),c.current=null)},[]);return a.useEffect(()=>()=>u(),[u]),Ie(()=>{var h;const d=l().find(m=>m.ref.current===document.activeElement);(h=d==null?void 0:d.ref.current)==null||h.scrollIntoView({block:"nearest"})},[l]),i.jsx(V.div,{"aria-hidden":!0,...o,ref:t,style:{flexShrink:0,...o.style},onPointerDown:H(o.onPointerDown,()=>{c.current===null&&(c.current=window.setInterval(r,50))}),onPointerMove:H(o.onPointerMove,()=>{var d;(d=s.onItemLeave)==null||d.call(s),c.current===null&&(c.current=window.setInterval(r,50))}),onPointerLeave:H(o.onPointerLeave,()=>{u()})})}),Ol="SelectSeparator",Uo=a.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e;return i.jsx(V.div,{"aria-hidden":!0,...r,ref:t})});Uo.displayName=Ol;var In="SelectArrow",Al=a.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e,o=tn(n),s=Be(In,n),c=He(In,n);return s.open&&c.position==="popper"?i.jsx(Vr,{...o,...r,ref:t}):null});Al.displayName=In;var Ll="SelectBubbleInput",Ko=a.forwardRef(({__scopeSelect:e,value:t,...n},r)=>{const o=a.useRef(null),s=te(r,o),c=wo(t);return a.useEffect(()=>{const l=o.current;if(!l)return;const u=window.HTMLSelectElement.prototype,h=Object.getOwnPropertyDescriptor(u,"value").set;if(c!==t&&h){const m=new Event("change",{bubbles:!0});h.call(l,t),l.dispatchEvent(m)}},[c,t]),i.jsx(V.select,{...n,style:{...ta,...n.style},ref:s,defaultValue:t})});Ko.displayName=Ll;function Go(e){return e===""||e===void 0}function Yo(e){const t=Cn(e),n=a.useRef(""),r=a.useRef(0),o=a.useCallback(c=>{const l=n.current+c;t(l),function u(d){n.current=d,window.clearTimeout(r.current),d!==""&&(r.current=window.setTimeout(()=>u(""),1e3))}(l)},[t]),s=a.useCallback(()=>{n.current="",window.clearTimeout(r.current)},[]);return a.useEffect(()=>()=>window.clearTimeout(r.current),[]),[n,o,s]}function Xo(e,t,n){const o=t.length>1&&Array.from(t).every(d=>d===t[0])?t[0]:t,s=n?e.indexOf(n):-1;let c=_l(e,Math.max(s,0));o.length===1&&(c=c.filter(d=>d!==n));const u=c.find(d=>d.textValue.toLowerCase().startsWith(o.toLowerCase()));return u!==n?u:void 0}function _l(e,t){return e.map((n,r)=>e[(t+r)%e.length])}var Bl=yo,qo=So,Hl=Eo,Fl=No,zl=jo,Zo=Io,$l=ko,Vl=Oo,Qo=Lo,Jo=Bo,Wl=Ho,Ul=zo,es=$o,ts=Vo,ns=Uo;const Kl=Bl,Gl=Vl,Yl=Hl,rs=a.forwardRef(({className:e,children:t,...n},r)=>i.jsxs(qo,{ref:r,className:L("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-mirage-300 bg-mirage-50 px-3 py-2 text-sm shadow-sm ring-offset-white placeholder:text-mirage-500 focus:border-transparent focus:outline-none focus:ring-2 focus:ring-primary disabled:cursor-not-allowed disabled:opacity-50 dark:border-mirage-800 dark:bg-mirage-950 dark:ring-offset-mirage-950 dark:placeholder:text-mirage-400 dark:focus:ring-primary-dark [&>span]:line-clamp-1",e),...n,children:[t,i.jsx(Fl,{asChild:!0,children:i.jsx(ol,{className:"h-4 w-4 opacity-50"})})]}));rs.displayName=qo.displayName;const os=a.forwardRef(({className:e,...t},n)=>i.jsx(es,{ref:n,className:L("flex cursor-default items-center justify-center py-1",e),...t,children:i.jsx(cl,{})}));os.displayName=es.displayName;const ss=a.forwardRef(({className:e,...t},n)=>i.jsx(ts,{ref:n,className:L("flex cursor-default items-center justify-center py-1",e),...t,children:i.jsx(il,{})}));ss.displayName=ts.displayName;const as=a.forwardRef(({className:e,children:t,position:n="popper",...r},o)=>i.jsx(zl,{children:i.jsxs(Zo,{ref:o,className:L("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-primary bg-mirage-50 text-mirage-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-primary-dark dark:bg-mirage-950 dark:text-mirage-50",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:n,...r,children:[i.jsx(os,{}),i.jsx($l,{className:L("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),i.jsx(ss,{})]})}));as.displayName=Zo.displayName;const is=a.forwardRef(({className:e,...t},n)=>i.jsx(Qo,{ref:n,className:L("px-2 py-1.5 text-sm font-semibold",e),...t}));is.displayName=Qo.displayName;const ht=a.forwardRef(({className:e,children:t,...n},r)=>i.jsxs(Jo,{ref:r,className:L("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-mirage-100 focus:text-mirage-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-mirage-900 dark:focus:text-mirage-50",e),...n,children:[i.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(Ul,{children:i.jsx(bo,{className:"h-4 w-4"})})}),i.jsx(Wl,{children:t})]}));ht.displayName=Jo.displayName;const Xl=a.forwardRef(({className:e,...t},n)=>i.jsx(ns,{ref:n,className:L("-mx-1 my-1 h-px bg-mirage-100 dark:bg-mirage-800",e),...t}));Xl.displayName=ns.displayName;function ql({children:e,onBlur:t,...n}){const r=a.useCallback(o=>{const s=o.currentTarget;requestAnimationFrame(()=>{s.contains(document.activeElement)||t()})},[t]);return i.jsx("div",{...n,onBlur:r,tabIndex:-1,children:e})}const ls=a.forwardRef(({className:e,type:t,...n},r)=>i.jsx("input",{type:t,className:L("flex h-[34px] w-full rounded-md border-0 border-transparent bg-transparent px-3 text-sm outline-none transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-mirage-500 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50 dark:placeholder:text-mirage-400",e),ref:r,...n}));ls.displayName="Input2";const Je=(e,t,n)=>[e,{code:e,codeHint:()=>t,parserHint:n}],Zl=new Map([Je("r","Roll",e=>$e(de(e))?`Roll ${de(e)}`:"Invalid Roll"),Je("gr","GM Roll",e=>$e(de(e))?`Roll ${de(e)} secretly`:"Invalid Roll"),Je("d","Roll Damage",e=>$e(de(e))?`Roll ${de(e)} damage`:"Invalid Roll"),Je("h","Roll Healing",e=>$e(de(e))?`Roll ${de(e)} healing`:"Invalid Roll")]),Ql=new Map([Je("r","Roll",e=>$e(de(e))?`Roll ${de(e)}`:"Invalid Roll"),Je("pr","Roll privately",e=>$e(de(e))?`Roll ${de(e)} privately`:"Invalid Roll")]),Jl=e=>e.substring(0,e.indexOf(" ")),de=e=>(e=e.substring(e.indexOf(" ")+1),e=e.replace(/\s/g,""),e=e.replaceAll("+"," + "),e=e.replaceAll("-"," - "),e),$e=e=>{let t=!0;try{pa.parse(e)}catch{t=!1}return t};function ec({dispatch:e,playerRole:t,playerName:n}){const[r,o]=a.useState(""),[s,c]=a.useState(0),[l,u]=a.useState("initial"),d=a.useRef(null),h=t==="GM"?Zl:Ql,m=new Map,w=new Map;let p=0,S=[];const f=Jl(r);if(h.has(f)){const v=()=>{const x=()=>{const C=de(r);return $e(C)?C:null},y=(C,E)=>{e(E==="PRIVATE"?{type:"add-roll",diceExpression:C,playerName:n,visibility:E,playerId:ee.player.id,dispatch:e}:{type:"add-roll",diceExpression:C,visibility:E,playerName:n,dispatch:e})};switch(f){case"r":{const C=x();C&&y(C,"PUBLIC");break}case"gr":{const C=x();C&&y(C,"GM");break}case"pr":{const C=x();C&&y(C,"PRIVATE");break}case"d":{const C=x();C&&(y(C,"GM"),e({type:"set-operation",operation:"damage"}));break}case"h":{const C=x();C&&(y(C,"GM"),e({type:"set-operation",operation:"healing"}));break}case"o":{e({type:"set-operation",operation:"overwrite"});break}default:console.log("unhandled command")}d.current&&d.current.blur(),u(!1)};p++,w.set(p,"roll demo"),m.set("roll demo",v);const g=h.get(f);g&&S.push(i.jsxs(Er,{index:p,targetIndex:s,onSelectionConfirm:v,children:[i.jsx("div",{className:"py-1 pl-1",children:g.parserHint(r)}),p===s&&i.jsx("div",{className:"ml-auto justify-end text-mirage-500 dark:text-mirage-500",children:"enter"})]},f+"parser"))}else for(const v of h){const g=()=>{o(`${v[0]} `),d.current&&d.current.focus()};p++,w.set(p,v[0]),m.set(v[0],g),S.push(i.jsxs(Er,{targetIndex:s,index:p,onSelectionConfirm:g,children:[i.jsx("div",{className:L("flex size-7 items-center justify-center rounded-sm drop-shadow",{"bg-mirage-50 dark:bg-mirage-800":s===p,"bg-mirage-50 group-hover/command-item:bg-mirage-50/70 dark:bg-mirage-900 dark:group-hover/command-item:bg-mirage-800/70":s!==p}),children:i.jsx("div",{className:"pb-0.5",children:v[0]})}),i.jsx("div",{children:v[1].codeHint()}),p===s&&i.jsx("div",{className:"ml-auto justify-end text-mirage-500 dark:text-mirage-500",children:"enter"})]},v[0]))}(s>S.length||s<1)&&c(1);const b=v=>{const g=()=>{s>1?c(s-1):c(S.length),v.preventDefault()},x=()=>{s<S.length?c(s+1):c(1),v.preventDefault()};switch(v.key){case"Escape":d.current&&d.current.blur();break;case"ArrowUp":g();break;case"ArrowDown":x();break;case"Tab":(l===!0||l==="initial")&&(v.shiftKey?g():x());break;case"Enter":const y=w.get(s);if(y){const C=m.get(y);C&&C()}break}};return i.jsx("div",{className:"relative z-10 w-[500px] flex-grow overflow-visible",children:i.jsx(ql,{onBlur:()=>{u(!1)},children:i.jsxs("div",{className:"absolute w-full rounded-md border border-mirage-300 bg-mirage-50 shadow-sm dark:border-mirage-800 dark:bg-mirage-950 focus-within:[&:has(:focus-visible)]:border-transparent focus-within:[&:has(:focus-visible)]:ring-2 focus-within:[&:has(:focus-visible)]:ring-primary dark:focus-within:[&:has(:focus-visible)]:ring-primary-dark",children:[i.jsx(ls,{ref:d,id:ha,placeholder:"Enter a command",value:r,spellCheck:!1,onChange:v=>{o(v.target.value),u(r===""?"from-null":!0)},onKeyDown:v=>b(v),onFocus:v=>{v.relatedTarget===null&&l!=="initial"?u("from-null"):u(!0)}}),(l===!0||l==="from-null")&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"p-2 pt-0",children:i.jsx(Vt,{className:"mt-0"})}),i.jsx(_n,{type:"scroll",className:"p-2 pt-0",children:i.jsx("div",{className:"flex max-h-[330px] flex-col gap-1",children:S})})]})]})})})}function Er({index:e,targetIndex:t,onSelectorFocus:n,onSelectionConfirm:r,children:o}){const s=a.useRef(null),c=()=>{s.current!==null&&s.current.scrollIntoView({behavior:"instant",block:"nearest"})};return a.useEffect(()=>{t===e&&(c(),n&&n())},[t]),i.jsx("div",{ref:s,className:L("group/command-item flex w-full items-center gap-2 rounded-sm p-1 pr-4 text-sm",{"bg-mirage-100 dark:bg-mirage-900":t===e,"bg-transparent hover:bg-mirage-100/70 dark:bg-transparent dark:hover:bg-mirage-900/70":t!==e}),onClick:l=>{l.stopPropagation(),r()},children:o})}function tc({appState:e,dispatch:t,playerRole:n,playerName:r}){return i.jsxs("div",{className:"flex gap-2 p-4 pb-2 pt-3",children:[i.jsx(ec,{dispatch:t,playerRole:n,playerName:r}),n==="GM"?i.jsxs(i.Fragment,{children:[i.jsxs(Kl,{value:e.operation,onValueChange:o=>{t({type:"set-operation",operation:o})},children:[i.jsx(rs,{className:"w-[180px]",children:i.jsx(Yl,{placeholder:"Editor Mode"})}),i.jsx(as,{children:i.jsxs(Gl,{children:[i.jsx(is,{children:"Operation"}),i.jsx(ht,{value:"none",children:"None"}),i.jsx(ht,{value:"damage",children:"Damage"}),i.jsx(ht,{value:"healing",children:"Heal"}),i.jsx(ht,{value:"overwrite",children:"Overwrite Multiple"})]})})]}),i.jsx(Ce,{size:"icon",variant:"outline",className:"shrink-0",onClick:async()=>{const o=(await ee.theme.getTheme()).mode;ee.popover.open({id:Sa("settings"),url:`settings.html?themeMode=${o}`,height:500,width:400})},children:i.jsx(dl,{className:"size-5"})})]}):i.jsxs("div",{className:"flex gap-2",children:[i.jsx(Tt,{name:"Patreon",icon:i.jsx(ia,{}),href:"https://www.patreon.com/SeamusFinlayson"}),i.jsx(Tt,{name:"Change Log",icon:i.jsx(la,{}),href:"https://www.patreon.com/collection/306916?view=expanded"}),i.jsx(Tt,{name:"Instructions",icon:i.jsx(ca,{}),href:"https://github.com/SeamusFinlayson/Bubbles-for-Owlbear-Rodeo?tab=readme-ov-file#how-it-works"}),i.jsx(Tt,{name:"Report Bug",icon:i.jsx(ua,{}),href:"https://discord.gg/WMp9bky4be"})]})]})}const cs=a.forwardRef(({className:e,...t},n)=>i.jsx("div",{className:"relative w-full overflow-auto",children:i.jsx("table",{ref:n,className:L("w-full caption-bottom text-sm",e),...t})}));cs.displayName="Table";const us=a.forwardRef(({className:e,...t},n)=>i.jsx("thead",{ref:n,className:L("[&_tr]:border-b",e),...t}));us.displayName="TableHeader";const ds=a.forwardRef(({className:e,...t},n)=>i.jsx("tbody",{ref:n,className:L("[&_tr:last-child]:border-0",e),...t}));ds.displayName="TableBody";const nc=a.forwardRef(({className:e,...t},n)=>i.jsx("tfoot",{ref:n,className:L("border-t bg-mirage-100/50 font-medium dark:bg-mirage-800/50 [&>tr]:last:border-b-0",e),...t}));nc.displayName="TableFooter";const Wn=a.forwardRef(({className:e,...t},n)=>i.jsx("tr",{ref:n,className:L("border-b border-mirage-300 transition-colors hover:bg-mirage-50/70 data-[state=selected]:bg-mirage-100 dark:border-mirage-800 dark:hover:bg-mirage-900/70 dark:data-[state=selected]:bg-mirage-800",e),...t}));Wn.displayName="TableRow";const Fe=a.forwardRef(({className:e,...t},n)=>i.jsx("th",{ref:n,className:L("h-10 px-2 text-left align-middle font-medium text-mirage-500 dark:text-mirage-400 [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t}));Fe.displayName="TableHead";const je=a.forwardRef(({className:e,...t},n)=>i.jsx("td",{ref:n,className:L("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t}));je.displayName="TableCell";const rc=a.forwardRef(({className:e,...t},n)=>i.jsx("caption",{ref:n,className:L("mt-4 text-sm text-mirage-500 dark:text-mirage-400",e),...t}));rc.displayName="TableCaption";var nn="Checkbox",[oc]=Ln(nn),[sc,Un]=oc(nn);function ac(e){const{__scopeCheckbox:t,checked:n,children:r,defaultChecked:o,disabled:s,form:c,name:l,onCheckedChange:u,required:d,value:h="on",internal_do_not_use_render:m}=e,[w,p]=$t({prop:n,defaultProp:o??!1,onChange:u,caller:nn}),[S,f]=a.useState(null),[b,v]=a.useState(null),g=a.useRef(!1),x=S?!!c||!!S.closest("form"):!0,y={checked:w,disabled:s,setChecked:p,control:S,setControl:f,name:l,form:c,value:h,hasConsumerStoppedPropagationRef:g,required:d,defaultChecked:Le(o)?!1:o,isFormControl:x,bubbleInput:b,setBubbleInput:v};return i.jsx(sc,{scope:t,...y,children:ic(m)?m(y):r})}var fs="CheckboxTrigger",hs=a.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:n,...r},o)=>{const{control:s,value:c,disabled:l,checked:u,required:d,setControl:h,setChecked:m,hasConsumerStoppedPropagationRef:w,isFormControl:p,bubbleInput:S}=Un(fs,e),f=te(o,h),b=a.useRef(u);return a.useEffect(()=>{const v=s==null?void 0:s.form;if(v){const g=()=>m(b.current);return v.addEventListener("reset",g),()=>v.removeEventListener("reset",g)}},[s,m]),i.jsx(V.button,{type:"button",role:"checkbox","aria-checked":Le(u)?"mixed":u,"aria-required":d,"data-state":xs(u),"data-disabled":l?"":void 0,disabled:l,value:c,...r,ref:f,onKeyDown:H(t,v=>{v.key==="Enter"&&v.preventDefault()}),onClick:H(n,v=>{m(g=>Le(g)?!0:!g),S&&p&&(w.current=v.isPropagationStopped(),w.current||v.stopPropagation())})})});hs.displayName=fs;var Kn=a.forwardRef((e,t)=>{const{__scopeCheckbox:n,name:r,checked:o,defaultChecked:s,required:c,disabled:l,value:u,onCheckedChange:d,form:h,...m}=e;return i.jsx(ac,{__scopeCheckbox:n,checked:o,defaultChecked:s,disabled:l,required:c,onCheckedChange:d,name:r,form:h,value:u,internal_do_not_use_render:({isFormControl:w})=>i.jsxs(i.Fragment,{children:[i.jsx(hs,{...m,ref:t,__scopeCheckbox:n}),w&&i.jsx(vs,{__scopeCheckbox:n})]})})});Kn.displayName=nn;var ps="CheckboxIndicator",ms=a.forwardRef((e,t)=>{const{__scopeCheckbox:n,forceMount:r,...o}=e,s=Un(ps,n);return i.jsx(An,{present:r||Le(s.checked)||s.checked===!0,children:i.jsx(V.span,{"data-state":xs(s.checked),"data-disabled":s.disabled?"":void 0,...o,ref:t,style:{pointerEvents:"none",...e.style}})})});ms.displayName=ps;var gs="CheckboxBubbleInput",vs=a.forwardRef(({__scopeCheckbox:e,...t},n)=>{const{control:r,hasConsumerStoppedPropagationRef:o,checked:s,defaultChecked:c,required:l,disabled:u,name:d,value:h,form:m,bubbleInput:w,setBubbleInput:p}=Un(gs,e),S=te(n,p),f=wo(s),b=na(r);a.useEffect(()=>{const g=w;if(!g)return;const x=window.HTMLInputElement.prototype,C=Object.getOwnPropertyDescriptor(x,"checked").set,E=!o.current;if(f!==s&&C){const R=new Event("click",{bubbles:E});g.indeterminate=Le(s),C.call(g,Le(s)?!1:s),g.dispatchEvent(R)}},[w,f,s,o]);const v=a.useRef(Le(s)?!1:s);return i.jsx(V.input,{type:"checkbox","aria-hidden":!0,defaultChecked:c??v.current,required:l,disabled:u,name:d,value:h,form:m,...t,tabIndex:-1,ref:S,style:{...t.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});vs.displayName=gs;function ic(e){return typeof e=="function"}function Le(e){return e==="indeterminate"}function xs(e){return Le(e)?"indeterminate":e?"checked":"unchecked"}const Gn=a.forwardRef(({className:e,...t},n)=>i.jsx("div",{className:"flex items-center justify-center px-1",children:i.jsx(Kn,{ref:n,className:L("peer size-[18px] shrink-0 rounded-sm border border-mirage-300 shadow focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-mirage-50 dark:border-mirage-800 dark:focus-visible:ring-primary-dark dark:data-[state=checked]:bg-primary-dark dark:data-[state=checked]:text-mirage-900",e),...t,children:i.jsx(ms,{className:L("flex items-center justify-center text-current"),children:i.jsx(bo,{className:"size-[18px]"})})})}));Gn.displayName=Kn.displayName;function lc(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.useMemo(()=>r=>{t.forEach(o=>o(r))},t)}const rn=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function ot(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function Yn(e){return"nodeType"in e}function ae(e){var t,n;return e?ot(e)?e:Yn(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function Xn(e){const{Document:t}=ae(e);return e instanceof t}function Rt(e){return ot(e)?!1:e instanceof ae(e).HTMLElement}function bs(e){return e instanceof ae(e).SVGElement}function st(e){return e?ot(e)?e.document:Yn(e)?Xn(e)?e:Rt(e)||bs(e)?e.ownerDocument:document:document:document}const Se=rn?a.useLayoutEffect:a.useEffect;function qn(e){const t=a.useRef(e);return Se(()=>{t.current=e}),a.useCallback(function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.current==null?void 0:t.current(...r)},[])}function cc(){const e=a.useRef(null),t=a.useCallback((r,o)=>{e.current=setInterval(r,o)},[]),n=a.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function wt(e,t){t===void 0&&(t=[e]);const n=a.useRef(e);return Se(()=>{n.current!==e&&(n.current=e)},t),n}function Et(e,t){const n=a.useRef();return a.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function Ut(e){const t=qn(e),n=a.useRef(null),r=a.useCallback(o=>{o!==n.current&&(t==null||t(o,n.current)),n.current=o},[]);return[n,r]}function Tn(e){const t=a.useRef();return a.useEffect(()=>{t.current=e},[e]),t.current}let xn={};function Nt(e,t){return a.useMemo(()=>{if(t)return t;const n=xn[e]==null?0:xn[e]+1;return xn[e]=n,e+"-"+n},[e,t])}function ws(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.reduce((s,c)=>{const l=Object.entries(c);for(const[u,d]of l){const h=s[u];h!=null&&(s[u]=h+e*d)}return s},{...t})}}const tt=ws(1),Kt=ws(-1);function uc(e){return"clientX"in e&&"clientY"in e}function Zn(e){if(!e)return!1;const{KeyboardEvent:t}=ae(e.target);return t&&e instanceof t}function dc(e){if(!e)return!1;const{TouchEvent:t}=ae(e.target);return t&&e instanceof t}function Pn(e){if(dc(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return uc(e)?{x:e.clientX,y:e.clientY}:null}const yt=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[yt.Translate.toString(e),yt.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),Nr="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function fc(e){return e.matches(Nr)?e:e.querySelector(Nr)}const hc={display:"none"};function pc(e){let{id:t,value:n}=e;return se.createElement("div",{id:t,style:hc},n)}function mc(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return se.createElement("div",{id:t,style:o,role:"status","aria-live":r,"aria-atomic":!0},n)}function gc(){const[e,t]=a.useState("");return{announce:a.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const ys=a.createContext(null);function vc(e){const t=a.useContext(ys);a.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function xc(){const[e]=a.useState(()=>new Set),t=a.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[a.useCallback(r=>{let{type:o,event:s}=r;e.forEach(c=>{var l;return(l=c[o])==null?void 0:l.call(c,s)})},[e]),t]}const bc={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},wc={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function yc(e){let{announcements:t=wc,container:n,hiddenTextDescribedById:r,screenReaderInstructions:o=bc}=e;const{announce:s,announcement:c}=gc(),l=Nt("DndLiveRegion"),[u,d]=a.useState(!1);if(a.useEffect(()=>{d(!0)},[]),vc(a.useMemo(()=>({onDragStart(m){let{active:w}=m;s(t.onDragStart({active:w}))},onDragMove(m){let{active:w,over:p}=m;t.onDragMove&&s(t.onDragMove({active:w,over:p}))},onDragOver(m){let{active:w,over:p}=m;s(t.onDragOver({active:w,over:p}))},onDragEnd(m){let{active:w,over:p}=m;s(t.onDragEnd({active:w,over:p}))},onDragCancel(m){let{active:w,over:p}=m;s(t.onDragCancel({active:w,over:p}))}}),[s,t])),!u)return null;const h=se.createElement(se.Fragment,null,se.createElement(pc,{id:r,value:o.draggable}),se.createElement(mc,{id:l,announcement:c}));return n?ze.createPortal(h,n):h}var U;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(U||(U={}));function Gt(){}function Cc(e,t){return a.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function Sc(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const me=Object.freeze({x:0,y:0});function Rc(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Ec(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function Nc(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function jc(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function jr(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const Ic=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=jr(t,t.left,t.top),s=[];for(const c of r){const{id:l}=c,u=n.get(l);if(u){const d=Rc(jr(u),o);s.push({id:l,data:{droppableContainer:c,value:d}})}}return s.sort(Ec)};function Tc(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),o=Math.min(t.left+t.width,e.left+e.width),s=Math.min(t.top+t.height,e.top+e.height),c=o-r,l=s-n;if(r<o&&n<s){const u=t.width*t.height,d=e.width*e.height,h=c*l,m=h/(u+d-h);return Number(m.toFixed(4))}return 0}const Pc=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=[];for(const s of r){const{id:c}=s,l=n.get(c);if(l){const u=Tc(l,t);u>0&&o.push({id:c,data:{droppableContainer:s,value:u}})}}return o.sort(Nc)};function Dc(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function Cs(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:me}function kc(e){return function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];return o.reduce((c,l)=>({...c,top:c.top+e*l.y,bottom:c.bottom+e*l.y,left:c.left+e*l.x,right:c.right+e*l.x}),{...n})}}const Mc=kc(1);function Oc(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Ac(e,t,n){const r=Oc(t);if(!r)return e;const{scaleX:o,scaleY:s,x:c,y:l}=r,u=e.left-c-(1-o)*parseFloat(n),d=e.top-l-(1-s)*parseFloat(n.slice(n.indexOf(" ")+1)),h=o?e.width/o:e.width,m=s?e.height/s:e.height;return{width:h,height:m,top:d,right:u+h,bottom:d+m,left:u}}const Lc={ignoreTransform:!1};function at(e,t){t===void 0&&(t=Lc);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:d,transformOrigin:h}=ae(e).getComputedStyle(e);d&&(n=Ac(n,d,h))}const{top:r,left:o,width:s,height:c,bottom:l,right:u}=n;return{top:r,left:o,width:s,height:c,bottom:l,right:u}}function Ir(e){return at(e,{ignoreTransform:!0})}function _c(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function Bc(e,t){return t===void 0&&(t=ae(e).getComputedStyle(e)),t.position==="fixed"}function Hc(e,t){t===void 0&&(t=ae(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const s=t[o];return typeof s=="string"?n.test(s):!1})}function Qn(e,t){const n=[];function r(o){if(t!=null&&n.length>=t||!o)return n;if(Xn(o)&&o.scrollingElement!=null&&!n.includes(o.scrollingElement))return n.push(o.scrollingElement),n;if(!Rt(o)||bs(o)||n.includes(o))return n;const s=ae(e).getComputedStyle(o);return o!==e&&Hc(o,s)&&n.push(o),Bc(o,s)?n:r(o.parentNode)}return e?r(e):n}function Ss(e){const[t]=Qn(e,1);return t??null}function bn(e){return!rn||!e?null:ot(e)?e:Yn(e)?Xn(e)||e===st(e).scrollingElement?window:Rt(e)?e:null:null}function Rs(e){return ot(e)?e.scrollX:e.scrollLeft}function Es(e){return ot(e)?e.scrollY:e.scrollTop}function Dn(e){return{x:Rs(e),y:Es(e)}}var X;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(X||(X={}));function Ns(e){return!rn||!e?!1:e===document.scrollingElement}function js(e){const t={x:0,y:0},n=Ns(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},o=e.scrollTop<=t.y,s=e.scrollLeft<=t.x,c=e.scrollTop>=r.y,l=e.scrollLeft>=r.x;return{isTop:o,isLeft:s,isBottom:c,isRight:l,maxScroll:r,minScroll:t}}const Fc={x:.2,y:.2};function zc(e,t,n,r,o){let{top:s,left:c,right:l,bottom:u}=n;r===void 0&&(r=10),o===void 0&&(o=Fc);const{isTop:d,isBottom:h,isLeft:m,isRight:w}=js(e),p={x:0,y:0},S={x:0,y:0},f={height:t.height*o.y,width:t.width*o.x};return!d&&s<=t.top+f.height?(p.y=X.Backward,S.y=r*Math.abs((t.top+f.height-s)/f.height)):!h&&u>=t.bottom-f.height&&(p.y=X.Forward,S.y=r*Math.abs((t.bottom-f.height-u)/f.height)),!w&&l>=t.right-f.width?(p.x=X.Forward,S.x=r*Math.abs((t.right-f.width-l)/f.width)):!m&&c<=t.left+f.width&&(p.x=X.Backward,S.x=r*Math.abs((t.left+f.width-c)/f.width)),{direction:p,speed:S}}function $c(e){if(e===document.scrollingElement){const{innerWidth:s,innerHeight:c}=window;return{top:0,left:0,right:s,bottom:c,width:s,height:c}}const{top:t,left:n,right:r,bottom:o}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:o,width:e.clientWidth,height:e.clientHeight}}function Is(e){return e.reduce((t,n)=>tt(t,Dn(n)),me)}function Vc(e){return e.reduce((t,n)=>t+Rs(n),0)}function Wc(e){return e.reduce((t,n)=>t+Es(n),0)}function Uc(e,t){if(t===void 0&&(t=at),!e)return;const{top:n,left:r,bottom:o,right:s}=t(e);Ss(e)&&(o<=0||s<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Kc=[["x",["left","right"],Vc],["y",["top","bottom"],Wc]];class Jn{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=Qn(n),o=Is(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[s,c,l]of Kc)for(const u of c)Object.defineProperty(this,u,{get:()=>{const d=l(r),h=o[s]-d;return this.rect[u]+h},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class pt{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var o;(o=this.target)==null||o.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function Gc(e){const{EventTarget:t}=ae(e);return e instanceof t?e:st(e)}function wn(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var he;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(he||(he={}));function Tr(e){e.preventDefault()}function Yc(e){e.stopPropagation()}var A;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(A||(A={}));const Ts={start:[A.Space,A.Enter],cancel:[A.Esc],end:[A.Space,A.Enter,A.Tab]},Xc=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case A.Right:return{...n,x:n.x+25};case A.Left:return{...n,x:n.x-25};case A.Down:return{...n,y:n.y+25};case A.Up:return{...n,y:n.y-25}}};class Ps{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new pt(st(n)),this.windowListeners=new pt(ae(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(he.Resize,this.handleCancel),this.windowListeners.add(he.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(he.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&Uc(r),n(me)}handleKeyDown(t){if(Zn(t)){const{active:n,context:r,options:o}=this.props,{keyboardCodes:s=Ts,coordinateGetter:c=Xc,scrollBehavior:l="smooth"}=o,{code:u}=t;if(s.end.includes(u)){this.handleEnd(t);return}if(s.cancel.includes(u)){this.handleCancel(t);return}const{collisionRect:d}=r.current,h=d?{x:d.left,y:d.top}:me;this.referenceCoordinates||(this.referenceCoordinates=h);const m=c(t,{active:n,context:r.current,currentCoordinates:h});if(m){const w=Kt(m,h),p={x:0,y:0},{scrollableAncestors:S}=r.current;for(const f of S){const b=t.code,{isTop:v,isRight:g,isLeft:x,isBottom:y,maxScroll:C,minScroll:E}=js(f),R=$c(f),j={x:Math.min(b===A.Right?R.right-R.width/2:R.right,Math.max(b===A.Right?R.left:R.left+R.width/2,m.x)),y:Math.min(b===A.Down?R.bottom-R.height/2:R.bottom,Math.max(b===A.Down?R.top:R.top+R.height/2,m.y))},D=b===A.Right&&!g||b===A.Left&&!x,P=b===A.Down&&!y||b===A.Up&&!v;if(D&&j.x!==m.x){const T=f.scrollLeft+w.x,_=b===A.Right&&T<=C.x||b===A.Left&&T>=E.x;if(_&&!w.y){f.scrollTo({left:T,behavior:l});return}_?p.x=f.scrollLeft-T:p.x=b===A.Right?f.scrollLeft-C.x:f.scrollLeft-E.x,p.x&&f.scrollBy({left:-p.x,behavior:l});break}else if(P&&j.y!==m.y){const T=f.scrollTop+w.y,_=b===A.Down&&T<=C.y||b===A.Up&&T>=E.y;if(_&&!w.x){f.scrollTo({top:T,behavior:l});return}_?p.y=f.scrollTop-T:p.y=b===A.Down?f.scrollTop-C.y:f.scrollTop-E.y,p.y&&f.scrollBy({top:-p.y,behavior:l});break}}this.handleMove(t,tt(Kt(m,this.referenceCoordinates),p))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Ps.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=Ts,onActivation:o}=t,{active:s}=n;const{code:c}=e.nativeEvent;if(r.start.includes(c)){const l=s.activatorNode.current;return l&&e.target!==l?!1:(e.preventDefault(),o==null||o({event:e.nativeEvent}),!0)}return!1}}];function Pr(e){return!!(e&&"distance"in e)}function Dr(e){return!!(e&&"delay"in e)}class er{constructor(t,n,r){var o;r===void 0&&(r=Gc(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:s}=t,{target:c}=s;this.props=t,this.events=n,this.document=st(c),this.documentListeners=new pt(this.document),this.listeners=new pt(r),this.windowListeners=new pt(ae(c)),this.initialCoordinates=(o=Pn(s))!=null?o:me,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(he.Resize,this.handleCancel),this.windowListeners.add(he.DragStart,Tr),this.windowListeners.add(he.VisibilityChange,this.handleCancel),this.windowListeners.add(he.ContextMenu,Tr),this.documentListeners.add(he.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Dr(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Pr(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:o}=this.props;o(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(he.Click,Yc,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(he.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:o,props:s}=this,{onMove:c,options:{activationConstraint:l}}=s;if(!o)return;const u=(n=Pn(t))!=null?n:me,d=Kt(o,u);if(!r&&l){if(Pr(l)){if(l.tolerance!=null&&wn(d,l.tolerance))return this.handleCancel();if(wn(d,l.distance))return this.handleStart()}if(Dr(l)&&wn(d,l.tolerance))return this.handleCancel();this.handlePending(l,d);return}t.cancelable&&t.preventDefault(),c(u)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===A.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const qc={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Ds extends er{constructor(t){const{event:n}=t,r=st(n.target);super(t,qc,r)}}Ds.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r==null||r({event:n}),!0)}}];const Zc={move:{name:"mousemove"},end:{name:"mouseup"}};var kn;(function(e){e[e.RightClick=2]="RightClick"})(kn||(kn={}));class ks extends er{constructor(t){super(t,Zc,st(t.event.target))}}ks.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===kn.RightClick?!1:(r==null||r({event:n}),!0)}}];const yn={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Qc extends er{constructor(t){super(t,yn)}static setup(){return window.addEventListener(yn.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(yn.move.name,t)};function t(){}}}Qc.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:o}=n;return o.length>1?!1:(r==null||r({event:n}),!0)}}];var mt;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(mt||(mt={}));var Yt;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(Yt||(Yt={}));function Jc(e){let{acceleration:t,activator:n=mt.Pointer,canScroll:r,draggingRect:o,enabled:s,interval:c=5,order:l=Yt.TreeOrder,pointerCoordinates:u,scrollableAncestors:d,scrollableAncestorRects:h,delta:m,threshold:w}=e;const p=tu({delta:m,disabled:!s}),[S,f]=cc(),b=a.useRef({x:0,y:0}),v=a.useRef({x:0,y:0}),g=a.useMemo(()=>{switch(n){case mt.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case mt.DraggableRect:return o}},[n,o,u]),x=a.useRef(null),y=a.useCallback(()=>{const E=x.current;if(!E)return;const R=b.current.x*v.current.x,j=b.current.y*v.current.y;E.scrollBy(R,j)},[]),C=a.useMemo(()=>l===Yt.TreeOrder?[...d].reverse():d,[l,d]);a.useEffect(()=>{if(!s||!d.length||!g){f();return}for(const E of C){if((r==null?void 0:r(E))===!1)continue;const R=d.indexOf(E),j=h[R];if(!j)continue;const{direction:D,speed:P}=zc(E,j,g,t,w);for(const T of["x","y"])p[T][D[T]]||(P[T]=0,D[T]=0);if(P.x>0||P.y>0){f(),x.current=E,S(y,c),b.current=P,v.current=D;return}}b.current={x:0,y:0},v.current={x:0,y:0},f()},[t,y,r,f,s,c,JSON.stringify(g),JSON.stringify(p),S,d,C,h,JSON.stringify(w)])}const eu={x:{[X.Backward]:!1,[X.Forward]:!1},y:{[X.Backward]:!1,[X.Forward]:!1}};function tu(e){let{delta:t,disabled:n}=e;const r=Tn(t);return Et(o=>{if(n||!r||!o)return eu;const s={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[X.Backward]:o.x[X.Backward]||s.x===-1,[X.Forward]:o.x[X.Forward]||s.x===1},y:{[X.Backward]:o.y[X.Backward]||s.y===-1,[X.Forward]:o.y[X.Forward]||s.y===1}}},[n,t,r])}function nu(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return Et(o=>{var s;return t==null?null:(s=r??o)!=null?s:null},[r,t])}function ru(e,t){return a.useMemo(()=>e.reduce((n,r)=>{const{sensor:o}=r,s=o.activators.map(c=>({eventName:c.eventName,handler:t(c.handler,r)}));return[...n,...s]},[]),[e,t])}var Ct;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Ct||(Ct={}));var Mn;(function(e){e.Optimized="optimized"})(Mn||(Mn={}));const kr=new Map;function ou(e,t){let{dragging:n,dependencies:r,config:o}=t;const[s,c]=a.useState(null),{frequency:l,measure:u,strategy:d}=o,h=a.useRef(e),m=b(),w=wt(m),p=a.useCallback(function(v){v===void 0&&(v=[]),!w.current&&c(g=>g===null?v:g.concat(v.filter(x=>!g.includes(x))))},[w]),S=a.useRef(null),f=Et(v=>{if(m&&!n)return kr;if(!v||v===kr||h.current!==e||s!=null){const g=new Map;for(let x of e){if(!x)continue;if(s&&s.length>0&&!s.includes(x.id)&&x.rect.current){g.set(x.id,x.rect.current);continue}const y=x.node.current,C=y?new Jn(u(y),y):null;x.rect.current=C,C&&g.set(x.id,C)}return g}return v},[e,s,n,m,u]);return a.useEffect(()=>{h.current=e},[e]),a.useEffect(()=>{m||p()},[n,m]),a.useEffect(()=>{s&&s.length>0&&c(null)},[JSON.stringify(s)]),a.useEffect(()=>{m||typeof l!="number"||S.current!==null||(S.current=setTimeout(()=>{p(),S.current=null},l))},[l,m,p,...r]),{droppableRects:f,measureDroppableContainers:p,measuringScheduled:s!=null};function b(){switch(d){case Ct.Always:return!1;case Ct.BeforeDragging:return n;default:return!n}}}function Ms(e,t){return Et(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function su(e,t){return Ms(e,t)}function au(e){let{callback:t,disabled:n}=e;const r=qn(t),o=a.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:s}=window;return new s(r)},[r,n]);return a.useEffect(()=>()=>o==null?void 0:o.disconnect(),[o]),o}function on(e){let{callback:t,disabled:n}=e;const r=qn(t),o=a.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:s}=window;return new s(r)},[n]);return a.useEffect(()=>()=>o==null?void 0:o.disconnect(),[o]),o}function iu(e){return new Jn(at(e),e)}function Mr(e,t,n){t===void 0&&(t=iu);const[r,o]=a.useState(null);function s(){o(u=>{if(!e)return null;if(e.isConnected===!1){var d;return(d=u??n)!=null?d:null}const h=t(e);return JSON.stringify(u)===JSON.stringify(h)?u:h})}const c=au({callback(u){if(e)for(const d of u){const{type:h,target:m}=d;if(h==="childList"&&m instanceof HTMLElement&&m.contains(e)){s();break}}}}),l=on({callback:s});return Se(()=>{s(),e?(l==null||l.observe(e),c==null||c.observe(document.body,{childList:!0,subtree:!0})):(l==null||l.disconnect(),c==null||c.disconnect())},[e]),r}function lu(e){const t=Ms(e);return Cs(e,t)}const Or=[];function cu(e){const t=a.useRef(e),n=Et(r=>e?r&&r!==Or&&e&&t.current&&e.parentNode===t.current.parentNode?r:Qn(e):Or,[e]);return a.useEffect(()=>{t.current=e},[e]),n}function uu(e){const[t,n]=a.useState(null),r=a.useRef(e),o=a.useCallback(s=>{const c=bn(s.target);c&&n(l=>l?(l.set(c,Dn(c)),new Map(l)):null)},[]);return a.useEffect(()=>{const s=r.current;if(e!==s){c(s);const l=e.map(u=>{const d=bn(u);return d?(d.addEventListener("scroll",o,{passive:!0}),[d,Dn(d)]):null}).filter(u=>u!=null);n(l.length?new Map(l):null),r.current=e}return()=>{c(e),c(s)};function c(l){l.forEach(u=>{const d=bn(u);d==null||d.removeEventListener("scroll",o)})}},[o,e]),a.useMemo(()=>e.length?t?Array.from(t.values()).reduce((s,c)=>tt(s,c),me):Is(e):me,[e,t])}function Ar(e,t){t===void 0&&(t=[]);const n=a.useRef(null);return a.useEffect(()=>{n.current=null},t),a.useEffect(()=>{const r=e!==me;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?Kt(e,n.current):me}function du(e){a.useEffect(()=>{if(!rn)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function fu(e,t){return a.useMemo(()=>e.reduce((n,r)=>{let{eventName:o,handler:s}=r;return n[o]=c=>{s(c,t)},n},{}),[e,t])}function Os(e){return a.useMemo(()=>e?_c(e):null,[e])}const Lr=[];function hu(e,t){t===void 0&&(t=at);const[n]=e,r=Os(n?ae(n):null),[o,s]=a.useState(Lr);function c(){s(()=>e.length?e.map(u=>Ns(u)?r:new Jn(t(u),u)):Lr)}const l=on({callback:c});return Se(()=>{l==null||l.disconnect(),c(),e.forEach(u=>l==null?void 0:l.observe(u))},[e]),o}function pu(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return Rt(t)?t:e}function mu(e){let{measure:t}=e;const[n,r]=a.useState(null),o=a.useCallback(d=>{for(const{target:h}of d)if(Rt(h)){r(m=>{const w=t(h);return m?{...m,width:w.width,height:w.height}:w});break}},[t]),s=on({callback:o}),c=a.useCallback(d=>{const h=pu(d);s==null||s.disconnect(),h&&(s==null||s.observe(h)),r(h?t(h):null)},[t,s]),[l,u]=Ut(c);return a.useMemo(()=>({nodeRef:l,rect:n,setRef:u}),[n,l,u])}const gu=[{sensor:Ds,options:{}},{sensor:Ps,options:{}}],vu={current:{}},zt={draggable:{measure:Ir},droppable:{measure:Ir,strategy:Ct.WhileDragging,frequency:Mn.Optimized},dragOverlay:{measure:at}};class gt extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const xu={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new gt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Gt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:zt,measureDroppableContainers:Gt,windowRect:null,measuringScheduled:!1},bu={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Gt,draggableNodes:new Map,over:null,measureDroppableContainers:Gt},sn=a.createContext(bu),As=a.createContext(xu);function wu(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new gt}}}function yu(e,t){switch(t.type){case U.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case U.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case U.DragEnd:case U.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case U.RegisterDroppable:{const{element:n}=t,{id:r}=n,o=new gt(e.droppable.containers);return o.set(r,n),{...e,droppable:{...e.droppable,containers:o}}}case U.SetDroppableDisabled:{const{id:n,key:r,disabled:o}=t,s=e.droppable.containers.get(n);if(!s||r!==s.key)return e;const c=new gt(e.droppable.containers);return c.set(n,{...s,disabled:o}),{...e,droppable:{...e.droppable,containers:c}}}case U.UnregisterDroppable:{const{id:n,key:r}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const s=new gt(e.droppable.containers);return s.delete(n),{...e,droppable:{...e.droppable,containers:s}}}default:return e}}function Cu(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:o}=a.useContext(sn),s=Tn(r),c=Tn(n==null?void 0:n.id);return a.useEffect(()=>{if(!t&&!r&&s&&c!=null){if(!Zn(s)||document.activeElement===s.target)return;const l=o.get(c);if(!l)return;const{activatorNode:u,node:d}=l;if(!u.current&&!d.current)return;requestAnimationFrame(()=>{for(const h of[u.current,d.current]){if(!h)continue;const m=fc(h);if(m){m.focus();break}}})}},[r,t,o,c,s]),null}function Su(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((o,s)=>s({transform:o,...r}),n):n}function Ru(e){return a.useMemo(()=>({draggable:{...zt.draggable,...e==null?void 0:e.draggable},droppable:{...zt.droppable,...e==null?void 0:e.droppable},dragOverlay:{...zt.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function Eu(e){let{activeNode:t,measure:n,initialRect:r,config:o=!0}=e;const s=a.useRef(!1),{x:c,y:l}=typeof o=="boolean"?{x:o,y:o}:o;Se(()=>{if(!c&&!l||!t){s.current=!1;return}if(s.current||!r)return;const d=t==null?void 0:t.node.current;if(!d||d.isConnected===!1)return;const h=n(d),m=Cs(h,r);if(c||(m.x=0),l||(m.y=0),s.current=!0,Math.abs(m.x)>0||Math.abs(m.y)>0){const w=Ss(d);w&&w.scrollBy({top:m.y,left:m.x})}},[t,c,l,r,n])}const Ls=a.createContext({...me,scaleX:1,scaleY:1});var Ae;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Ae||(Ae={}));const Nu=a.memo(function(t){var n,r,o,s;let{id:c,accessibility:l,autoScroll:u=!0,children:d,sensors:h=gu,collisionDetection:m=Pc,measuring:w,modifiers:p,...S}=t;const f=a.useReducer(yu,void 0,wu),[b,v]=f,[g,x]=xc(),[y,C]=a.useState(Ae.Uninitialized),E=y===Ae.Initialized,{draggable:{active:R,nodes:j,translate:D},droppable:{containers:P}}=b,T=R!=null?j.get(R):null,_=a.useRef({initial:null,translated:null}),z=a.useMemo(()=>{var Q;return R!=null?{id:R,data:(Q=T==null?void 0:T.data)!=null?Q:vu,rect:_}:null},[R,T]),$=a.useRef(null),[J,W]=a.useState(null),[B,ne]=a.useState(null),K=wt(S,Object.values(S)),Re=Nt("DndDescribedBy",c),Ee=a.useMemo(()=>P.getEnabled(),[P]),G=Ru(w),{droppableRects:ie,measureDroppableContainers:re,measuringScheduled:ge}=ou(Ee,{dragging:E,dependencies:[D.x,D.y],config:G.droppable}),Y=nu(j,R),I=a.useMemo(()=>B?Pn(B):null,[B]),M=Xs(),F=su(Y,G.draggable.measure);Eu({activeNode:R!=null?j.get(R):null,config:M.layoutShiftCompensation,initialRect:F,measure:G.draggable.measure});const N=Mr(Y,G.draggable.measure,F),O=Mr(Y?Y.parentElement:null),k=a.useRef({activatorEvent:null,active:null,activeNode:Y,collisionRect:null,collisions:null,droppableRects:ie,draggableNodes:j,draggingNode:null,draggingNodeRect:null,droppableContainers:P,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),oe=P.getNodeFor((n=k.current.over)==null?void 0:n.id),q=mu({measure:G.dragOverlay.measure}),ve=(r=q.nodeRef.current)!=null?r:Y,xe=E?(o=q.rect)!=null?o:N:null,Ke=!!(q.nodeRef.current&&q.rect),nr=lu(Ke?null:N),an=Os(ve?ae(ve):null),Te=cu(E?oe??Y:null),jt=hu(Te),It=Su(p,{transform:{x:D.x-nr.x,y:D.y-nr.y,scaleX:1,scaleY:1},activatorEvent:B,active:z,activeNodeRect:N,containerNodeRect:O,draggingNodeRect:xe,over:k.current.over,overlayNodeRect:q.rect,scrollableAncestors:Te,scrollableAncestorRects:jt,windowRect:an}),rr=I?tt(I,D):null,or=uu(Te),$s=Ar(or),Vs=Ar(or,[N]),Ge=tt(It,$s),Ye=xe?Mc(xe,It):null,it=z&&Ye?m({active:z,collisionRect:Ye,droppableRects:ie,droppableContainers:Ee,pointerCoordinates:rr}):null,sr=jc(it,"id"),[Pe,ar]=a.useState(null),Ws=Ke?It:tt(It,Vs),Us=Dc(Ws,(s=Pe==null?void 0:Pe.rect)!=null?s:null,N),ln=a.useRef(null),ir=a.useCallback((Q,le)=>{let{sensor:ce,options:De}=le;if($.current==null)return;const fe=j.get($.current);if(!fe)return;const ue=Q.nativeEvent,be=new ce({active:$.current,activeNode:fe,event:ue,options:De,context:k,onAbort(Z){if(!j.get(Z))return;const{onDragAbort:we}=K.current,Ne={id:Z};we==null||we(Ne),g({type:"onDragAbort",event:Ne})},onPending(Z,ke,we,Ne){if(!j.get(Z))return;const{onDragPending:ct}=K.current,Me={id:Z,constraint:ke,initialCoordinates:we,offset:Ne};ct==null||ct(Me),g({type:"onDragPending",event:Me})},onStart(Z){const ke=$.current;if(ke==null)return;const we=j.get(ke);if(!we)return;const{onDragStart:Ne}=K.current,lt={activatorEvent:ue,active:{id:ke,data:we.data,rect:_}};ze.unstable_batchedUpdates(()=>{Ne==null||Ne(lt),C(Ae.Initializing),v({type:U.DragStart,initialCoordinates:Z,active:ke}),g({type:"onDragStart",event:lt}),W(ln.current),ne(ue)})},onMove(Z){v({type:U.DragMove,coordinates:Z})},onEnd:Xe(U.DragEnd),onCancel:Xe(U.DragCancel)});ln.current=be;function Xe(Z){return async function(){const{active:we,collisions:Ne,over:lt,scrollAdjustedTranslate:ct}=k.current;let Me=null;if(we&&ct){const{cancelDrop:ut}=K.current;Me={activatorEvent:ue,active:we,collisions:Ne,delta:ct,over:lt},Z===U.DragEnd&&typeof ut=="function"&&await Promise.resolve(ut(Me))&&(Z=U.DragCancel)}$.current=null,ze.unstable_batchedUpdates(()=>{v({type:Z}),C(Ae.Uninitialized),ar(null),W(null),ne(null),ln.current=null;const ut=Z===U.DragEnd?"onDragEnd":"onDragCancel";if(Me){const cn=K.current[ut];cn==null||cn(Me),g({type:ut,event:Me})}})}}},[j]),Ks=a.useCallback((Q,le)=>(ce,De)=>{const fe=ce.nativeEvent,ue=j.get(De);if($.current!==null||!ue||fe.dndKit||fe.defaultPrevented)return;const be={active:ue};Q(ce,le.options,be)===!0&&(fe.dndKit={capturedBy:le.sensor},$.current=De,ir(ce,le))},[j,ir]),lr=ru(h,Ks);du(h),Se(()=>{N&&y===Ae.Initializing&&C(Ae.Initialized)},[N,y]),a.useEffect(()=>{const{onDragMove:Q}=K.current,{active:le,activatorEvent:ce,collisions:De,over:fe}=k.current;if(!le||!ce)return;const ue={active:le,activatorEvent:ce,collisions:De,delta:{x:Ge.x,y:Ge.y},over:fe};ze.unstable_batchedUpdates(()=>{Q==null||Q(ue),g({type:"onDragMove",event:ue})})},[Ge.x,Ge.y]),a.useEffect(()=>{const{active:Q,activatorEvent:le,collisions:ce,droppableContainers:De,scrollAdjustedTranslate:fe}=k.current;if(!Q||$.current==null||!le||!fe)return;const{onDragOver:ue}=K.current,be=De.get(sr),Xe=be&&be.rect.current?{id:be.id,rect:be.rect.current,data:be.data,disabled:be.disabled}:null,Z={active:Q,activatorEvent:le,collisions:ce,delta:{x:fe.x,y:fe.y},over:Xe};ze.unstable_batchedUpdates(()=>{ar(Xe),ue==null||ue(Z),g({type:"onDragOver",event:Z})})},[sr]),Se(()=>{k.current={activatorEvent:B,active:z,activeNode:Y,collisionRect:Ye,collisions:it,droppableRects:ie,draggableNodes:j,draggingNode:ve,draggingNodeRect:xe,droppableContainers:P,over:Pe,scrollableAncestors:Te,scrollAdjustedTranslate:Ge},_.current={initial:xe,translated:Ye}},[z,Y,it,Ye,j,ve,xe,ie,P,Pe,Te,Ge]),Jc({...M,delta:D,draggingRect:Ye,pointerCoordinates:rr,scrollableAncestors:Te,scrollableAncestorRects:jt});const Gs=a.useMemo(()=>({active:z,activeNode:Y,activeNodeRect:N,activatorEvent:B,collisions:it,containerNodeRect:O,dragOverlay:q,draggableNodes:j,droppableContainers:P,droppableRects:ie,over:Pe,measureDroppableContainers:re,scrollableAncestors:Te,scrollableAncestorRects:jt,measuringConfiguration:G,measuringScheduled:ge,windowRect:an}),[z,Y,N,B,it,O,q,j,P,ie,Pe,re,Te,jt,G,ge,an]),Ys=a.useMemo(()=>({activatorEvent:B,activators:lr,active:z,activeNodeRect:N,ariaDescribedById:{draggable:Re},dispatch:v,draggableNodes:j,over:Pe,measureDroppableContainers:re}),[B,lr,z,N,v,Re,j,Pe,re]);return se.createElement(ys.Provider,{value:x},se.createElement(sn.Provider,{value:Ys},se.createElement(As.Provider,{value:Gs},se.createElement(Ls.Provider,{value:Us},d)),se.createElement(Cu,{disabled:(l==null?void 0:l.restoreFocus)===!1})),se.createElement(yc,{...l,hiddenTextDescribedById:Re}));function Xs(){const Q=(J==null?void 0:J.autoScrollEnabled)===!1,le=typeof u=="object"?u.enabled===!1:u===!1,ce=E&&!Q&&!le;return typeof u=="object"?{...u,enabled:ce}:{enabled:ce}}}),ju=a.createContext(null),_r="button",Iu="Draggable";function Tu(e){let{id:t,data:n,disabled:r=!1,attributes:o}=e;const s=Nt(Iu),{activators:c,activatorEvent:l,active:u,activeNodeRect:d,ariaDescribedById:h,draggableNodes:m,over:w}=a.useContext(sn),{role:p=_r,roleDescription:S="draggable",tabIndex:f=0}=o??{},b=(u==null?void 0:u.id)===t,v=a.useContext(b?Ls:ju),[g,x]=Ut(),[y,C]=Ut(),E=fu(c,t),R=wt(n);Se(()=>(m.set(t,{id:t,key:s,node:g,activatorNode:y,data:R}),()=>{const D=m.get(t);D&&D.key===s&&m.delete(t)}),[m,t]);const j=a.useMemo(()=>({role:p,tabIndex:f,"aria-disabled":r,"aria-pressed":b&&p===_r?!0:void 0,"aria-roledescription":S,"aria-describedby":h.draggable}),[r,p,f,b,S,h.draggable]);return{active:u,activatorEvent:l,activeNodeRect:d,attributes:j,isDragging:b,listeners:r?void 0:E,node:g,over:w,setNodeRef:x,setActivatorNodeRef:C,transform:v}}function Pu(){return a.useContext(As)}const Du="Droppable",ku={timeout:25};function Mu(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:o}=e;const s=Nt(Du),{active:c,dispatch:l,over:u,measureDroppableContainers:d}=a.useContext(sn),h=a.useRef({disabled:n}),m=a.useRef(!1),w=a.useRef(null),p=a.useRef(null),{disabled:S,updateMeasurementsFor:f,timeout:b}={...ku,...o},v=wt(f??r),g=a.useCallback(()=>{if(!m.current){m.current=!0;return}p.current!=null&&clearTimeout(p.current),p.current=setTimeout(()=>{d(Array.isArray(v.current)?v.current:[v.current]),p.current=null},b)},[b]),x=on({callback:g,disabled:S||!c}),y=a.useCallback((j,D)=>{x&&(D&&(x.unobserve(D),m.current=!1),j&&x.observe(j))},[x]),[C,E]=Ut(y),R=wt(t);return a.useEffect(()=>{!x||!C.current||(x.disconnect(),m.current=!1,x.observe(C.current))},[C,x]),a.useEffect(()=>(l({type:U.RegisterDroppable,element:{id:r,key:s,disabled:n,node:C,rect:w,data:R}}),()=>l({type:U.UnregisterDroppable,key:s,id:r})),[r]),a.useEffect(()=>{n!==h.current.disabled&&(l({type:U.SetDroppableDisabled,id:r,key:s,disabled:n}),h.current.disabled=n)},[r,s,n,l]),{active:c,rect:w,isOver:(u==null?void 0:u.id)===r,node:C,over:u,setNodeRef:E}}function tr(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function Ou(e,t){return e.reduce((n,r,o)=>{const s=t.get(r);return s&&(n[o]=s),n},Array(e.length))}function At(e){return e!==null&&e>=0}function Au(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Lu(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const _s=e=>{let{rects:t,activeIndex:n,overIndex:r,index:o}=e;const s=tr(t,r,n),c=t[o],l=s[o];return!l||!c?null:{x:l.left-c.left,y:l.top-c.top,scaleX:l.width/c.width,scaleY:l.height/c.height}},Lt={scaleX:1,scaleY:1},_u=e=>{var t;let{activeIndex:n,activeNodeRect:r,index:o,rects:s,overIndex:c}=e;const l=(t=s[n])!=null?t:r;if(!l)return null;if(o===n){const d=s[c];return d?{x:0,y:n<c?d.top+d.height-(l.top+l.height):d.top-l.top,...Lt}:null}const u=Bu(s,o,n);return o>n&&o<=c?{x:0,y:-l.height-u,...Lt}:o<n&&o>=c?{x:0,y:l.height+u,...Lt}:{x:0,y:0,...Lt}};function Bu(e,t,n){const r=e[t],o=e[t-1],s=e[t+1];return r?n<t?o?r.top-(o.top+o.height):s?s.top-(r.top+r.height):0:s?s.top-(r.top+r.height):o?r.top-(o.top+o.height):0:0}const Bs="Sortable",Hs=se.createContext({activeIndex:-1,containerId:Bs,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:_s,disabled:{draggable:!1,droppable:!1}});function Hu(e){let{children:t,id:n,items:r,strategy:o=_s,disabled:s=!1}=e;const{active:c,dragOverlay:l,droppableRects:u,over:d,measureDroppableContainers:h}=Pu(),m=Nt(Bs,n),w=l.rect!==null,p=a.useMemo(()=>r.map(E=>typeof E=="object"&&"id"in E?E.id:E),[r]),S=c!=null,f=c?p.indexOf(c.id):-1,b=d?p.indexOf(d.id):-1,v=a.useRef(p),g=!Au(p,v.current),x=b!==-1&&f===-1||g,y=Lu(s);Se(()=>{g&&S&&h(p)},[g,p,S,h]),a.useEffect(()=>{v.current=p},[p]);const C=a.useMemo(()=>({activeIndex:f,containerId:m,disabled:y,disableTransforms:x,items:p,overIndex:b,useDragOverlay:w,sortedRects:Ou(p,u),strategy:o}),[f,m,y.draggable,y.droppable,x,p,b,u,w,o]);return se.createElement(Hs.Provider,{value:C},t)}const Fu=e=>{let{id:t,items:n,activeIndex:r,overIndex:o}=e;return tr(n,r,o).indexOf(t)},zu=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:o,items:s,newIndex:c,previousItems:l,previousContainerId:u,transition:d}=e;return!d||!r||l!==s&&o===c?!1:n?!0:c!==o&&t===u},$u={duration:200,easing:"ease"},Fs="transform",Vu=yt.Transition.toString({property:Fs,duration:0,easing:"linear"}),Wu={roleDescription:"sortable"};function Uu(e){let{disabled:t,index:n,node:r,rect:o}=e;const[s,c]=a.useState(null),l=a.useRef(n);return Se(()=>{if(!t&&n!==l.current&&r.current){const u=o.current;if(u){const d=at(r.current,{ignoreTransform:!0}),h={x:u.left-d.left,y:u.top-d.top,scaleX:u.width/d.width,scaleY:u.height/d.height};(h.x||h.y)&&c(h)}}n!==l.current&&(l.current=n)},[t,n,r,o]),a.useEffect(()=>{s&&c(null)},[s]),s}function Ku(e){let{animateLayoutChanges:t=zu,attributes:n,disabled:r,data:o,getNewIndex:s=Fu,id:c,strategy:l,resizeObserverConfig:u,transition:d=$u}=e;const{items:h,containerId:m,activeIndex:w,disabled:p,disableTransforms:S,sortedRects:f,overIndex:b,useDragOverlay:v,strategy:g}=a.useContext(Hs),x=Gu(r,p),y=h.indexOf(c),C=a.useMemo(()=>({sortable:{containerId:m,index:y,items:h},...o}),[m,o,y,h]),E=a.useMemo(()=>h.slice(h.indexOf(c)),[h,c]),{rect:R,node:j,isOver:D,setNodeRef:P}=Mu({id:c,data:C,disabled:x.droppable,resizeObserverConfig:{updateMeasurementsFor:E,...u}}),{active:T,activatorEvent:_,activeNodeRect:z,attributes:$,setNodeRef:J,listeners:W,isDragging:B,over:ne,setActivatorNodeRef:K,transform:Re}=Tu({id:c,data:C,attributes:{...Wu,...n},disabled:x.draggable}),Ee=lc(P,J),G=!!T,ie=G&&!S&&At(w)&&At(b),re=!v&&B,ge=re&&ie?Re:null,I=ie?ge??(l??g)({rects:f,activeNodeRect:z,activeIndex:w,overIndex:b,index:y}):null,M=At(w)&&At(b)?s({id:c,items:h,activeIndex:w,overIndex:b}):y,F=T==null?void 0:T.id,N=a.useRef({activeId:F,items:h,newIndex:M,containerId:m}),O=h!==N.current.items,k=t({active:T,containerId:m,isDragging:B,isSorting:G,id:c,index:y,items:h,newIndex:N.current.newIndex,previousItems:N.current.items,previousContainerId:N.current.containerId,transition:d,wasDragging:N.current.activeId!=null}),oe=Uu({disabled:!k,index:y,node:j,rect:R});return a.useEffect(()=>{G&&N.current.newIndex!==M&&(N.current.newIndex=M),m!==N.current.containerId&&(N.current.containerId=m),h!==N.current.items&&(N.current.items=h)},[G,M,m,h]),a.useEffect(()=>{if(F===N.current.activeId)return;if(F&&!N.current.activeId){N.current.activeId=F;return}const ve=setTimeout(()=>{N.current.activeId=F},50);return()=>clearTimeout(ve)},[F]),{active:T,activeIndex:w,attributes:$,data:C,rect:R,index:y,newIndex:M,items:h,isOver:D,isSorting:G,isDragging:B,listeners:W,node:j,overIndex:b,over:ne,setNodeRef:Ee,setActivatorNodeRef:K,setDroppableNodeRef:P,setDraggableNodeRef:J,transform:oe??I,transition:q()};function q(){if(oe||O&&N.current.newIndex===y)return Vu;if(!(re&&!Zn(_)||!d)&&(G||k))return yt.Transition.toString({...d,property:Fs})}}function Gu(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(r=e==null?void 0:e.droppable)!=null?r:t.droppable}}A.Down,A.Right,A.Up,A.Left;function Yu(e,t,n){const r={...e};return t.top+e.y<=n.top?r.y=n.top-t.top:t.bottom+e.y>=n.top+n.height&&(r.y=n.top+n.height-t.bottom),t.left+e.x<=n.left?r.x=n.left-t.left:t.right+e.x>=n.left+n.width&&(r.x=n.left+n.width-t.right),r}const Xu=e=>{let{draggingNodeRect:t,transform:n,scrollableAncestorRects:r}=e;const o=r[0];return!t||!o?n:Yu(n,t,o)};class zs extends ks{}cr(zs,"activators",[{eventName:"onMouseDown",handler:({nativeEvent:t})=>!(t.button!==0||qu(t.target))}]);function qu(e){const t=["input","textarea","select","option"];return!!(e!=null&&e.tagName&&t.includes(e.tagName.toLowerCase()))}function Zu({id:e,children:t,onKeyDown:n}){const{attributes:r,listeners:o,setNodeRef:s,transform:c,transition:l}=Ku({id:e}),u={transform:yt.Transform.toString(c),transition:l};return i.jsx(Wn,{ref:s,style:{...u},...r,...o,onKeyDown:n,tabIndex:-1,children:t})}function Qu({appState:e,dispatch:t,tokens:n,setTokens:r,playerRole:o,playerSelection:s,handleDragEnd:c}){const l=Sc(Cc(zs,{activationConstraint:{distance:{y:10}}}));return i.jsx(Nu,{sensors:l,modifiers:[Xu],collisionDetection:Ic,onDragEnd:o==="GM"?c:()=>{},children:i.jsx(Hu,{items:o==="GM"?n.map(u=>u.item.id):[],strategy:_u,children:i.jsxs(cs,{tabIndex:-1,children:[i.jsx(us,{children:i.jsxs(Wn,{children:[e.operation!=="none"&&i.jsx(nd,{included:od(n,e.includedItems),onCheckedChange:u=>t({type:"set-included-items",includedItems:new Map(n.map(d=>[d.item.id,u]))})}),i.jsx(Fe,{children:"Token"}),e.operation==="none"&&o==="GM"&&i.jsx(Fe,{children:"Access"}),e.operation!=="damage"&&i.jsx(Fe,{title:"Hit Points / Maximum Hit Points, Temporary Hit Points",children:"Stats"}),e.operation==="damage"&&i.jsxs(i.Fragment,{children:[i.jsx(Fe,{children:"Multiplier"}),i.jsx(Fe,{children:"Damage"}),i.jsx(Fe,{children:"New Hit Points"})]})]})}),i.jsx(ds,{children:n.map(u=>{const d=Bn(u.item.id,e.includedItems),h=ma(u.item.id,e.damageScaleOptions),m=Wr(d?h:0,e.value?e.value:0),[w,p]=ga(u.health,u.maxHealth,u.tempHealth,-1*m),S=()=>{t({type:"set-damage-scale-options",damageScaleOptions:new Map(e.damageScaleOptions).set(u.item.id,h<Br.length-1?h+1:h)})},f=()=>{t({type:"set-damage-scale-options",damageScaleOptions:new Map(e.damageScaleOptions).set(u.item.id,ba)})},b=()=>{t({type:"set-damage-scale-options",damageScaleOptions:new Map(e.damageScaleOptions).set(u.item.id,h>1?h-1:h)})},v=g=>{switch(g.code){case"ArrowLeft":b();break;case"ArrowRight":S();break;case"KeyR":f();break}};return i.jsxs(Zu,{id:u.item.id,onKeyDown:v,children:[e.operation!=="none"&&i.jsx(rd,{included:d,onCheckedChange:g=>t({type:"set-included-items",includedItems:e.includedItems.set(u.item.id,g)})}),i.jsx(ed,{token:u,faded:!d&&e.operation!=="none",playerSelection:s}),e.operation==="none"&&o==="GM"&&i.jsx(Ju,{token:u,setTokens:r}),e.operation!=="damage"&&i.jsx(je,{children:i.jsxs("div",{className:"grid min-w-[140px] grid-cols-2 justify-items-stretch gap-2 sm:min-w-[250px] sm:grid-cols-4",children:[i.jsxs("div",{className:"col-span-2 flex items-center justify-between gap-1",children:[i.jsx(Bt,{parentValue:u.health,name:"health",updateHandler:g=>_t(u.item.id,g,u.health,r)}),i.jsx("div",{children:"/"}),i.jsx(Bt,{parentValue:u.maxHealth,name:"maxHealth",updateHandler:g=>_t(u.item.id,g,u.maxHealth,r)})]}),i.jsx(Bt,{parentValue:u.tempHealth,name:"tempHealth",updateHandler:g=>_t(u.item.id,g,u.tempHealth,r)}),i.jsx(Bt,{parentValue:u.armorClass,name:"armorClass",updateHandler:g=>_t(u.item.id,g,u.armorClass,r)})]})}),e.operation==="damage"&&i.jsxs(i.Fragment,{children:[i.jsx(je,{children:i.jsxs("div",{className:"flex max-w-32 gap-2",children:[i.jsx(Ce,{className:"size-8 min-w-8 rounded-full",tabIndex:-1,size:"icon",variant:"outline",onClick:g=>{b(),g.stopPropagation()},children:i.jsx(el,{className:"size-4"})}),i.jsx(Ce,{className:"flex h-8 w-10 items-center justify-center text-lg font-medium",tabIndex:-1,variant:"ghost",onClick:g=>{f(),g.stopPropagation()},children:Br[h]}),i.jsx(Ce,{className:"size-8 min-w-8 rounded-full",tabIndex:-1,size:"icon",variant:"outline",onClick:g=>{S(),g.stopPropagation()},children:i.jsx(nl,{className:"size-4"})})]})}),i.jsx(je,{className:L({"text-mirage-500 dark:text-mirage-400":!d}),children:m}),i.jsx(je,{className:L("md:min-w-16 lg:min-w-20",{"text-mirage-500 dark:text-mirage-400":!d}),children:w.toString()+(p>0?` (${p})`:"")})]})]},u.item.id)})})]})})})}function Ju({token:e,setTokens:t}){return i.jsx(je,{className:"py-0",children:i.jsxs(vt,{children:[i.jsx(xt,{asChild:!0,children:i.jsx(Ce,{variant:"ghost",size:"icon",name:e.hideStats?"Make Stats Visible to Players":"Hide Stats from players",onClick:()=>td(e.item.id,e.hideStats,t),children:e.hideStats?i.jsx("div",{className:"text-primary-500 dark:text-primary-dark",children:i.jsx(Ra,{})}):i.jsx(Ea,{})})}),i.jsx(bt,{side:"right",children:e.hideStats?"Dungeon Master Only":"Player Editable"})]})})}function ed({token:e,faded:t,playerSelection:n}){const r=i.jsx("img",{className:"min-h-8 min-w-8",src:e.item.image.url});return i.jsx(je,{children:i.jsxs(vt,{children:[i.jsx(xt,{asChild:!0,children:i.jsx("div",{className:"flex items-center",children:i.jsx("button",{className:L("size-12 font-medium outline-none sm:size-8",{"opacity-60":t},{"outline-image dark:outline-image":n.includes(e.item.id)}),onClick:o=>xa(e.item.id,!(o.shiftKey||o.ctrlKey)),onDoubleClick:()=>va(e.item.id),tabIndex:-1,children:r})})}),i.jsx(bt,{side:"right",children:e.item.name})]})})}async function td(e,t,n){const r="hideStats";if(!Ur(r))throw"Error: invalid input name.";const o=!t;n(s=>{for(let c=0;c<s.length;c++)s[c].item.id===e&&(s[c]={...s[c],[r]:o});return[...s]}),Kr(e,r,o)}function _t(e,t,n,r){const o=t.name;if(!Ur(o))throw"Error: invalid input name.";const s=Na(o,t.value,n);r(c=>{for(let l=0;l<c.length;l++)c[l].item.id===e&&(c[l]={...c[l],[o]:s});return[...c]}),Kr(e,o,s)}function Bt({parentValue:e,updateHandler:t,name:n}){const[r,o]=a.useState(e.toString());let s=!1;const[c,l]=a.useState(!1);c&&(o(e.toString()),l(!1)),a.useEffect(()=>l(!0),[e]);const u=h=>{t(h.target),l(!0)},d=h=>{h.target.select()};return i.jsx(dt,{name:n,inputProps:{className:"w-full",value:r,onChange:h=>o(h.target.value),onBlur:h=>{s||u(h)},onKeyDown:h=>{h.key==="Enter"?h.target.blur():h.key==="Escape"&&(s=!0,h.target.blur(),s=!1,o(e.toString()))},onFocus:d,onClick:h=>h.stopPropagation()}})}function nd({included:e,onCheckedChange:t}){return i.jsx(je,{children:i.jsx(Gn,{checked:e,onCheckedChange:n=>{typeof n=="boolean"&&t(n)}})})}function rd({included:e,onCheckedChange:t}){return i.jsx(je,{children:i.jsx(Gn,{checked:e,onCheckedChange:n=>{typeof n=="boolean"&&t(n)}})})}const Br=["","","","1","2"],od=(e,t)=>{let n=!0,r=!0;for(const o of e){const s=Bn(o.item.id,t);s===!1&&(n=!1),s===!0&&(r=!1)}return n?!0:r?!1:"indeterminate"};function sd(){const[e,t]=a.useReducer(wa,{},()=>({operation:"none",showItems:"SELECTED",rolls:[],value:null,animateRoll:!1,statOverwrites:ya(),damageScaleOptions:new Map,includedItems:new Map,mostRecentSelection:[]})),[n,r]=a.useState([]),[o,s]=a.useState([]),[c,l]=a.useState("PLAYER"),[u,d]=a.useState(""),[h,m]=a.useState(!1),w=v=>(e.showItems==="ALL"||e.mostRecentSelection.includes(v.item.id)||Bn(v.item.id,e.includedItems))&&(c==="GM"||!v.hideStats)&&!(e.operation==="damage"&&v.maxHealth<=0)&&!(e.operation==="healing"&&v.maxHealth<=0),p=n.filter(w);function S(v){const{active:g,over:x}=v;x!=null&&x.id&&g.id!==x.id&&r(y=>{var j,D;const C=(j=y.find(P=>P.item.id===g.id))==null?void 0:j.index,E=(D=y.find(P=>P.item.id===x.id))==null?void 0:D.index,R=tr(y,C,E);for(let P=0;P<R.length;P++)R[P].index=P;return Ca(R),R})}const f=v=>{const g=ja(v);g.sort((x,y)=>(x.index===-1?g.length:x.index)-(y.index===-1?g.length:y.index));for(let x=0;x<g.length;x++)g[x].index=x;r(g)};a.useEffect(()=>ee.scene.items.onChange(f),[]),a.useEffect(()=>{const v=g=>{m(g),g?(ee.scene.items.getItems(hr).then(f),fr().then(x=>t({type:"set-rolls",rolls:x}))):r([])};return ee.scene.isReady().then(v),ee.scene.onReadyChange(v)},[]),a.useEffect(()=>{const v=async y=>{s(y||[]);const C=(await ee.scene.items.getItems(hr)).map(E=>E.id);if(y){const E=y.filter(R=>C.includes(R));E.length>0&&t({type:"set-most-recent-selection",mostRecentSelection:E})}},g=y=>{l(y),y==="PLAYER"&&t({type:"set-operation",operation:"none"})},x=y=>{d(y)};return ee.player.getSelection().then(v),ee.player.getRole().then(g),ee.player.getName().then(x),ee.player.onChange(y=>{v(y.selection),g(y.role),x(y.name)})},[]),a.useEffect(()=>ee.scene.onMetadataChange(async v=>{h&&t({type:"set-rolls",rolls:await fr(v)})}),[]),a.useEffect(()=>ee.theme.onChange(v=>Js(v.mode)),[]);const b=()=>c==="PLAYER"?i.jsx("div",{className:"flex h-full items-start justify-center p-2 text-mirage-400 dark:text-mirage-600",children:"Token list is GM only."}):p.length===0?i.jsx("div",{className:"flex h-full items-start justify-center p-2 text-mirage-400 dark:text-mirage-600",children:"The tokens you most recently selected on the map will be visible here."}):i.jsx(Qu,{appState:e,dispatch:t,tokens:p,setTokens:r,playerRole:c,playerSelection:o,handleDragEnd:S});return i.jsx("div",{className:"h-full overflow-clip",children:i.jsxs("div",{className:"flex h-full flex-col justify-between bg-mirage-100/90 dark:bg-mirage-940/85 dark:text-mirage-200",children:[i.jsx(tc,{appState:e,dispatch:t,playerRole:c,playerName:u}),i.jsxs(_n,{className:"h-full sm:px-4",children:[i.jsxs("div",{className:"flex flex-col items-center justify-start gap-2 pb-2",children:[b(),c==="GM"&&i.jsx(ad,{appState:e,dispatch:t})]}),i.jsx(da,{orientation:"horizontal",forceMount:!0})]}),i.jsx(Qi,{appState:e,dispatch:t,tokens:p,playerRole:c,playerName:u})]})})}function ad({appState:e,dispatch:t}){return i.jsx(Ce,{variant:"ghost",onClick:()=>t({type:"set-show-items",showItems:e.showItems==="ALL"?"SELECTED":"ALL"}),children:e.showItems==="ALL"?"Show Only Selected Tokens":"Show All Tokens"})}function xd(){return i.jsx(ra,{disableHoverableContent:!0,skipDelayDuration:0,delayDuration:400,children:i.jsx(sd,{})})}export{xd as default};
